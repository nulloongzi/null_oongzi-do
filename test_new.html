<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÎàÑÎ£ΩÏßÄÎèÑ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/528/528098.png">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCnzjy0jzK6HD34Z-i7tapG3y-hkrA-XaM",
            authDomain: "nulloongzi-do.firebaseapp.com",
            projectId: "nulloongzi-do",
            storageBucket: "nulloongzi-do.firebasestorage.app",
            messagingSenderId: "1024551952678",
            appId: "1:1024551952678:web:91a0df59c12b68b968a1e7",
            measurementId: "G-L1KWREQEMW"
        };

        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("üî• Firebase Ïó∞Í≤∞ ÏÑ±Í≥µ!");
        } catch (e) {
            console.error("Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®:", e);
        }

        // Î∞• Ï¢ÖÎ•òÎ≥Ñ ÏÉâÏÉÅ Ï†ïÏùò
        const riceData = [
            {name: "ÌòÑÎØ∏Î∞•", weight: 50, color: "#d7ccc8"}, 
            {name: "Î∞±ÎØ∏Î∞•", weight: 50, color: "#fafafa"}, 
            {name: "ÌùëÎØ∏Î∞•", weight: 50, color: "#b39ddb"}, 
            {name: "Î≥¥Î¶¨Î∞•", weight: 50, color: "#cfd8dc"}, 
            {name: "ÏΩ©Î∞•", weight: 50, color: "#a5d6a7"},   
            {name: "Ïò§Í≥°Î∞•", weight: 50, color: "#ffe0b2"}, 
            {name: "Ï∞®Ï°∞Î∞•", weight: 10, color: "#fff59d"}, 
            {name: "Í∏∞Ïû•Î∞•", weight: 10, color: "#fff9c4"}, 
            {name: "Ïà≠Îäâ", weight: 10, color: "#efebe9"},
            {name: "Î≥∂ÏùåÎ∞•", weight: 10, color: "#ffcc80"}, 
            {name: "ÎπÑÎπîÎ∞•", weight: 10, color: "#ffab91"}, 
            {name: "ÍπÄÎ∞•", weight: 10, color: "#bdbdbd"},   
            {name: "Ï£ºÎ®πÎ∞•", weight: 10, color: "#f5f5f5"},
            {name: "Ïú†Î∂ÄÏ¥àÎ∞•", weight: 10, color: "#ffe082"},
            {name: "ÎçÆÎ∞•", weight: 10, color: "#dcedc8"},
            {name: "Íµ≠Î∞•", weight: 10, color: "#cfd8dc"},
            {name: "ÏÜ•Î∞•", weight: 10, color: "#bcaaa4"},
            {name: "ÏïΩÎ∞•", weight: 10, color: "#8d6e63"},
            {name: "Ï£Ω", weight: 10, color: "#e0f2f1"},
            {name: "Í≥§ÎìúÎ†àÎ∞•", weight: 10, color: "#81c784"}, 
            {name: "ÏòÅÏñëÎ∞•", weight: 10, color: "#ffecb3"},
            {name: "ÏπòÎ∞•", weight: 10, color: "#ff8a65"}, 
            {name: "ÌñáÎ∞ò", weight: 10, color: "#ffffff"},
            {name: "Í≥†Î¥âÎ∞•", weight: 10, color: "#fbe9e7"},
            {name: "Î∞•ÏïÑÏ†ÄÏî®", weight: 1, color: "#4fc3f7"} 
        ];

        function generateRiceName() {
            let totalWeight = 0;
            for (let item of riceData) totalWeight += item.weight;
            let randomNum = Math.random() * totalWeight;
            let selected = riceData[0];
            for (let item of riceData) {
                if (randomNum < item.weight) { selected = item; break; }
                randomNum -= item.weight;
            }
            const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
            let suffix = "";
            for (let i = 0; i < 3; i++) suffix += chars.charAt(Math.floor(Math.random() * chars.length));
            return { base: selected.name, code: suffix, full: selected.name + "-" + suffix, color: selected.color };
        }

        // ÌòÑÏû¨ ÌÅ¥ÎüΩ Îç∞Ïù¥ÌÑ∞ Ïó∞Îèô (ÌååÏù¥Ïç¨ÏóêÏÑú Ï£ºÏûÖ)
        const allClubs = [{"name": "GVT", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í¥ëÏßÑÍµ¨ ÏïÑÏ∞®ÏÇ∞Î°ú70Í∏∏ 35", "schedule": "ÌÜ† 13:00~17:00", "price": "Ïõî 3ÎßåÏõê (ÌïôÏÉù 2ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gvt__official", "link": "", "lat": 37.5409675314785, "lng": 127.100704228215, "id": 0, "is_urgent": true, "urgent_msg": "üîπ ÎÇ®ÏûêÎ∂Ä Î™®ÏßëÏ§ë‚Äº Í≤åÏä§Ìä∏ ÌôòÏòÅ‚Äº üîπ"}, {"name": "Î∏åÏù¥ÌôÄÎ¶≠", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ÎèÑ ÏÑ±ÎÇ®Ïãú Î∂ÑÎãπÍµ¨ ÏñëÌòÑÎ°ú 262", "schedule": "Ìôî 19:00~22:00 / Í∏à 19:00~22:00 / Ïùº 14:00~18:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "v_holic_2010", "link": "", "lat": 37.4073263996148, "lng": 127.126612716157, "id": 1, "is_urgent": false, "urgent_msg": ""}, {"name": "H_B", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÍ∏∞ÎèÑ ÏàòÏõêÏãú Ïû•ÏïàÍµ¨ ÏàòÏùºÎ°ú233Î≤àÍ∏∏ 15", "schedule": "Ïàò 18:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê (Ïã∏Îã§Ïã∏!)", "insta": "hb_volleyball_club", "link": "http://www.hb-volleyball.co.kr", "lat": 37.3073441859489, "lng": 127.015667305962, "id": 2, "is_urgent": false, "urgent_msg": ""}, {"name": "H_B", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÍ∏∞ÎèÑ ÌôîÏÑ±Ïãú Îß§ÏÜ°Î©¥ Îß§ÏÜ°Î°ú 41", "schedule": "ÌÜ† 18:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê (Ïã∏Îã§Ïã∏!)", "insta": "hb_volleyball_club", "link": "http://www.hb-volleyball.co.kr", "lat": 37.2518258783031, "lng": 126.909629549921, "id": 3, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎèôÎëêÏ≤úÌôîÎ™©Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ÎèÑ ÎèôÎëêÏ≤úÏãú Ïñ¥ÏàòÎ°ú 4", "schedule": "Ïõî 19:30~22:00 / Ïàò 19:30~22:00 / Í∏à 19:30~22:00", "price": "Ïõî 1ÎßåÏõê", "insta": "ddc_voller", "link": "https://open.kakao.com/o/p10jZzWh", "lat": 37.9052629454328, "lng": 127.043063227981, "id": 4, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌåÄÌÅêÎ∏å", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, (Ïó¨ÏÑ±Ï†ÑÏö©, 6Ïù∏Ï†ú)", "address": "ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÏÇºÏÑ±Î°ú135Í∏∏ 42", "schedule": "Ïõî 19:00~21:00 / Ïàò 19:00~21:00", "price": "Ïõî 6.5ÎßåÏõê(Ï£º2Ìöå 11ÎßåÏõê) / Í≤åÏä§Ìä∏ 2.5ÎßåÏõê", "insta": "teamcubevc", "link": "", "lat": 37.520125172379, "lng": 127.044715764538, "id": 5, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ±Î∂ÅSVA", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "ÏÑúÏö∏ ÏÑ±Î∂ÅÍµ¨ ÌôîÎûëÎ°ú13Í∏∏ 144", "schedule": "Ìôî 19:00~22:00 / Î™© 19:00~22:00", "price": "Ïõî 8ÎßåÏõê", "insta": "kr_sports_plus", "link": "", "lat": 37.6085494620429, "lng": 127.042324971736, "id": 6, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎùºÏù¥ÌÅ¨Î∞úÎ¶¨Î≥º", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ïù∏Ï≤ú ÎØ∏Ï∂îÌôÄÍµ¨ ÏÑùÏ†ïÎ°ú 165", "schedule": "ÌÜ† 12:30~16:30", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "likevolleyball_team", "link": "", "lat": 37.4739644136398, "lng": 126.651978806147, "id": 7, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎùºÏù¥ÌÅ¨Î∞úÎ¶¨Î≥º", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ïù∏Ï≤ú ÏÑúÍµ¨ ÌïúÏ§ëÎ°ú 25", "schedule": "Ïàò 18:00~21:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "likevolleyball_team", "link": "", "lat": 37.5795849502601, "lng": 126.672802385687, "id": 8, "is_urgent": false, "urgent_msg": ""}, {"name": "JKÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏãúÌù•Ïãú Ïû•Í≥°Î°ú 10", "schedule": "Ïùº 10:00~13:00", "price": "ÌöåÎπÑ3Îßå / Í≤åÏä§Ìä∏ÎπÑ ÏóÜÏùå", "insta": "", "link": "https://m.cafe.daum.net/volleyballsok/IfzY/3333?searchView=Y", "lat": 37.3798358362533, "lng": 126.787616614841, "id": 9, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÉàÎ°ú(CERO)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ Í∞ïÎèôÍµ¨ ÏÉÅÏùºÎ°ú12Í∏∏ 56", "schedule": "ÌÜ† 14:00~17:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "cero_vc", "link": "", "lat": 37.5556127825867, "lng": 127.174608361426, "id": 10, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎßàÏÇ∞Î≤†Ïä§Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÎÇ® Ï∞ΩÏõêÏãú ÎßàÏÇ∞ÌöåÏõêÍµ¨ ÌåîÏö©Î°ú 280", "schedule": "Ìôî 19:00~21:00 / Î™© 19:00~21:00", "price": "Ïõî3ÎßåÏõê", "insta": "masan_best", "link": "", "lat": 35.248323558591, "lng": 128.602594607144, "id": 11, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎåÄÍµ¨ NTC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, (ÏÑ†Ï∂úÍ∞ÄÎä•, Íµ∞ÎØ∏ÌïÑ ÏÉÅÍ¥Äx)", "address": "ÎåÄÍµ¨ Îã¨ÏÑúÍµ¨ Í≥ÑÎåÄÎèôÎ¨∏Î°ú3Í∏∏ 46", "schedule": "Ïõî 18:30~21:30 / Ïàò 18:30~21:30 / Î™© 18:30~21:30", "price": "Ïõî3ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ x", "insta": "ntc_volleyball", "link": "", "lat": 35.8579351866729, "lng": 128.494745397447, "id": 12, "is_urgent": false, "urgent_msg": ""}, {"name": "Í¥ëÎ™ÖÏÑ†Ïö∞", "target": "Î¨¥Í¥Ä", "address": "Í≤ΩÍ∏∞ Í¥ëÎ™ÖÏãú Í∞ÄÎ¶ºÎ°ú 18 ÌïòÏïàÎ∂ÅÏ¥àÎì±ÌïôÍµê", "schedule": "Ïùº 13:00~17:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "volleyball_sunwoo", "link": "", "lat": 37.4647085135351, "lng": 126.869134235278, "id": 13, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïö∞Î¶¨ÌïòÎ™®Îãà", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (Ïó¨ÏÑ±Ï†ÑÏö©)", "address": "ÏÑúÏö∏ ÏñëÏ≤úÍµ¨ ÎÇ®Î∂ÄÏàúÌôòÎ°ú 380", "schedule": "ÌÜ† 14:00~18:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "harmony__volleyball", "link": "", "lat": 37.5326758132814, "lng": 126.828972567552, "id": 14, "is_urgent": false, "urgent_msg": ""}, {"name": "FAV", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ÎèÑ Í≥†ÏñëÏãú ÏùºÏÇ∞ ÏÑúÍµ¨ ÏÜ°Ìè¨Î∞±ÏÜ°Í∏∏ 70-1", "schedule": "Ïõî 19:40~21:30 / Ìôî 19:40~21:30 / Ïàò 19:40~21:30 / Î™© 19:40~21:30 / Í∏à 19:40~21:30", "price": "ÏÑ±Ïù∏ Ïõî Í∏∞Ï§Ä - Ï£º 1Ìöå 14ÎßåÏõê, Ï£º 2~3Ìöå 19ÎßåÏõê", "insta": "favclub.official", "link": "http://litt.ly/fav_volleyball", "lat": 37.6929835875228, "lng": 126.736120374622, "id": 15, "is_urgent": false, "urgent_msg": ""}, {"name": "Íµ¨ÎØ∏ Í±∞Î∂ÅÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Î¨¥Í¥Ä (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÎ∂Å Íµ¨ÎØ∏Ïãú ÌòïÍ≥°Î°ú14Í∏∏ 5-20", "schedule": "Ìôî 18:30~21:30 / ÌÜ† 14:00~17:30", "price": "Ïõî 2ÎßåÏõê", "insta": "volleyball_gumi", "link": "https://m.cafe.naver.com/geobukclub.cafe?utm_source=ig&utm_medium=social&utm_content=link_in_bio&fbclid=PAb21jcAOw3JBleHRuA2FlbQIxMQBzcnRjBmFwcF9pZA81NjcwNjczNDMzNTI0MjcAAact0OTzvMhVFL7QPLtsO9AWmiWgTsYPFoXQoegc5zLSWZD2Xd0HgqvY9Fs8Sg_aem_zOfY0iLzVbb2vT-dMgNk2Q", "lat": 36.1147023025135, "lng": 128.329775063006, "id": 16, "is_urgent": false, "urgent_msg": ""}, {"name": "Í∞ïÏÑúVC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ Í∞ïÏÑúÍµ¨ Îì±Ï¥åÎ°ú39Í∏∏ 71", "schedule": "Ïàò 18:00~21:00 / ÌÜ† 15:00~18:00", "price": "Î∂ÑÍ∏∞ 8ÎßåÏõê(ÌïôÏÉù 5ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gangseo.vc", "link": "", "lat": 37.5476142187642, "lng": 126.857942163854, "id": 17, "is_urgent": false, "urgent_msg": ""}, {"name": "Î†àÎìúÌå°Ïä§", "target": "ÏÑ±Ïù∏", "address": "ÏÑúÏö∏ ÎÖ∏ÏõêÍµ¨ ÏÑ¨Î∞≠Î°ú 181", "schedule": "Î™© 18:00~21:00 / Ïùº 16:30~19:30", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê", "insta": "", "link": "https://www.daangn.com/kr/group/%EB%B0%B0%EA%B5%AC%EB%8F%99%ED%98%B8%ED%9A%8C-%EB%A0%88%EB%93%9C%ED%8C%A1%EC%8A%A4-2wq9tjryem95/", "lat": 37.632255170053, "lng": 127.066056635951, "id": 18, "is_urgent": false, "urgent_msg": ""}, {"name": "Ï†ïÎ¨¥Î∞∞Íµ¨", "target": "Î¨¥Í¥Ä", "address": "Ï†ÑÎ∂Å Ï†ÑÏ£ºÏãú ÎçïÏßÑÍµ¨ ÎßåÏÑ±Î∂Å4Í∏∏ 10", "schedule": "Ïàò 19:00~21:00 / Î™© 19:00~21:00", "price": "Ï£º1Ìöå Ïõî 5ÎßåÏõê, Ï£º2Ìöå Ïõî 7ÎßåÏõê", "insta": "jeongmu_volley", "link": "", "lat": 35.8477726720349, "lng": 127.074701125365, "id": 19, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏïàÏÑ± ÎÑòÎ≤ÑÎÇòÏù∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú ÎπÑÎ£°Î°ú 78", "schedule": "Ïàò 19:00~21:40", "price": "", "insta": "anseong_no9_volleyballclub", "link": "https://www.youtube.com/@%EC%95%88%EC%84%B1%EB%84%98%EB%B2%84%EB%82%98%EC%9D%B89", "lat": 37.015078008763, "lng": 127.263020902801, "angle": 0.0, "id": 20, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌïòÏù¥Î∞úÎ¶¨", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú Îã§Ïú®Î°ú30", "schedule": "Ïàò 19:00~21:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "high.volley", "link": "", "lat": 37.7379799283829, "lng": 126.726930320218, "id": 21, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏûÑÌå©Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú ÏõîÎ°±Î©¥ Ìú¥ÏïîÎ°ú 434", "schedule": "Î™© 19:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "paju_impact", "link": "http://kko.to/7v33m3qZj", "lat": 37.8300288380237, "lng": 126.781056138359, "id": 22, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏûÑÌå©Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú Ìï¥ÏÜîÎ°ú 60", "schedule": "ÌÜ† 13:00~17:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "paju_impact", "link": "http://kko.to/7v33m3qZj", "lat": 37.7274642059342, "lng": 126.745874918567, "id": 23, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏïàÏÑ±MVP", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú Í≥µÎèÑÏùç Í∏∞ÏóÖÎã®ÏßÄÎ°ú 57", "schedule": "Ìôî 19:00~21:30 / Î™© 19:00~21:30", "price": "Ïõî 3ÎßåÏõê", "insta": "mvp_official_2014", "link": "https://open.kakao.com/o/s8T9ZYWe", "lat": 37.0028098402492, "lng": 127.15850296807, "id": 24, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎåÄÍµ¨ ÎëêÎ•òÎ∞∞Íµ¨Ìöå", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ, Î¨¥Í¥Ä", "address": "ÎåÄÍµ¨ Îã¨ÏÑúÍµ¨ ÏÑúÎãπÎ°ú 30", "schedule": "Ïùº 09:00~13:00", "price": "ÌöåÎπÑ ÎÇ®:Ïõî 2ÎßåÏõê, Ïó¨:Ïõî 1ÎßåÏõê (Í∞ÄÏûÖÎπÑ 3ÎßåÏõê)", "insta": "", "link": "https://open.kakao.com/o/sNOhf3Ah", "lat": 35.8545121028952, "lng": 128.496514228915, "id": 25, "is_urgent": false, "urgent_msg": ""}, {"name": "DGZ", "target": "ÏÑ±Ïù∏", "address": "ÏÑúÏö∏ ÎèôÏûëÍµ¨ Ïû•ÏäπÎ∞∞Í∏∞Î°ú10Í∞ÄÍ∏∏ 35", "schedule": "Ïùº 9:30~14:20 (ÎÇ®ÎÖÄ ÎëêÏãúÍ∞ÑÏî©)", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê (ÌòÑÏû¨ Î¨¥Î£å)", "insta": "dgz_volleyball_club", "link": "", "lat": 37.5027160069897, "lng": 126.940926768444, "angle": 0.0, "id": 26, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïó¨ÏàòÏóêÏù¥Ïä§", "target": "ÏÑ±Ïù∏", "address": "Ï†ÑÎÇ® Ïó¨ÏàòÏãú ÏõÖÏ≤úÎ∂Å4Î°ú 9", "schedule": "Ìôî 18:30~21:40 / Í∏à 18:30~21:40", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "yeosu_ace_volleyball", "link": "", "lat": 34.7483267150984, "lng": 127.684825674004, "id": 27, "is_urgent": false, "urgent_msg": ""}, {"name": "V.O.L", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎèôÏûëÍµ¨ Ïû•ÏäπÎ∞∞Í∏∞Î°ú10Í∞ÄÍ∏∏ 35", "schedule": "Ïàò 18:30~21:30 / ÌÜ† 12:30~18:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "v.o.l_volleyball", "link": "", "lat": 37.5027160069897, "lng": 126.940726768444, "angle": 3.141592653589793, "id": 28, "is_urgent": false, "urgent_msg": ""}, {"name": "Î†àÏù¥ÎçîÏä§", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú ÎπÑÎ£°Î°ú 78", "schedule": "Ìôî 19:00~21:30 / Í∏à 19:00~21:30", "price": "30ÏÑ∏ ÎØ∏Îßå Ïõî 1ÎßåÏõê, 30ÏÑ∏ Ïù¥ÏÉÅ Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ ÏóÜÏùå", "insta": "raiders_volleyball_team", "link": "", "lat": 37.015078008763, "lng": 127.262820902801, "angle": 3.141592653589793, "id": 29, "is_urgent": false, "urgent_msg": ""}, {"name": "Í≤ΩÏ£º ÎçîÏºÄÏù¥", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÎ∂Å Í≤ΩÏ£ºÏãú Í¥ëÏ§ë2Í∏∏ 28", "schedule": "Ìôî 18:00~20:00 / Î™© 18:00~20:00", "price": "Ïõî 3.5ÎßåÏõê (Ïó∞ÎÇ© 3ÎßåÏõê) / 1ÌöåÏ≤¥ÌóòÎπÑ Î¨¥Î£å", "insta": "thek_vbc", "link": "pf.kakao.com/_xcTaxmn", "lat": 35.8849473288934, "lng": 129.229737107908, "id": 30, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏõêÏ£º Ïä§ÎßàÏùº Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "Î¨¥Í¥Ä", "address": "Í∞ïÏõê ÏõêÏ£ºÏãú ÎÇ®ÏõêÎ°ú 551", "schedule": "Ìôî 18:00~22:00 / ÌÜ† 13:00~16:00", "price": "Ïõî ÏÑ±Ïù∏ 2.5ÎßåÏõê, ÎåÄÌïôÏÉù1.5ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ 5Ï≤úÏõê", "insta": "smile.volleyball.club_", "link": "https://open.kakao.com/o/gTs0Mpse", "lat": 37.3338307104893, "lng": 127.946303709594, "id": 31, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïö∞ÏÇ¨Î™® SWVC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎèÑÎ¥âÍµ¨ Ïö∞Ïù¥Ï≤úÎ°ú 432", "schedule": "Ïùº 13:00~18:00", "price": "Ïõî 4ÎßåÏõê(ÌïôÏÉù Î∞è Î¨¥ÏßÅÏùÄ 3ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "swvc_volley", "link": "", "lat": 37.6526987118348, "lng": 127.0184004627, "id": 32, "is_urgent": false, "urgent_msg": ""}, {"name": "NWN", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎÖ∏ÏõêÍµ¨ ÌïúÍ∏ÄÎπÑÏÑùÎ°ú 566", "schedule": "Ïàò 18:30~21:30 / ÌÜ† 15:00~19:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "nowon_no.1_volleyball", "link": "https://m.cafe.daum.net/nowon-no.1/_rec?utm_source=ig&utm_medium=social&utm_content=link_in_bio", "lat": 37.6648178269709, "lng": 127.054322233957, "id": 33, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïñ¥ÎÇòÎçîÎ†àÎ≤®", "target": "Î¨¥Í¥Ä", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú Îã§Ï†ïÎÇ®Î°ú 91", "schedule": "Ïàò 19:00~21:30", "price": "Ïã†Í∑ú Ï≤´Îã¨ 6Îßå / Ïõî 3Îßå / Í≤åÏä§Ìä∏1ÌöåÎ¨¥Î£å(2Ìöå 1ÎßåÏõê)", "insta": "khp4949", "link": "https://open.kakao.com/o/g3dvQE4g", "lat": 36.4939039101709, "lng": 127.250966962615, "id": 34, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏãúÌù• ÏàòÏöîÎ∞∞Íµ¨Ìöå ÌîΩÏóÖÍ≤åÏûÑ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏãúÌù•Ïãú Ïû•Í≥°Î°ú54Î≤àÍ∏∏ 14", "schedule": "Ïàò 17:50~20:50", "price": "ÏóÜÏùå", "insta": "volleyball_pickup_siheung", "link": "https://open.kakao.com/o/s2KVlj0h", "lat": 37.380779446634, "lng": 126.78327876897, "id": 35, "is_urgent": false, "urgent_msg": ""}, {"name": "Íµ∞Ìè¨Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ Íµ∞Ìè¨Ïãú ÏÇ∞Î≥∏Î°ú 267", "schedule": "Ïùº 10:00~16:00", "price": "Ïõî 2.5ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gunpo_volleyball", "link": "https://open.kakao.com/o/g1qV2i3h", "lat": 37.3540356844596, "lng": 126.936815220052, "id": 36, "is_urgent": false, "urgent_msg": ""}, {"name": "Î∂ÄÏÇ∞Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "Î∂ÄÏÇ∞ Î∂ÅÍµ¨ ÎçïÏ≤ú2Í∏∏ 10", "schedule": "Ìôî 18:00~21:00", "price": "ÏÑ±Ïù∏ Ïõî 2ÎßåÏõê (ÎåÄÌïôÏÉù Ïõî 1.5ÎßåÏõê, Í≥†Îì±ÌïôÏÉù Ïõî 1ÎßåÏõê)", "insta": "volleyball_busan", "link": "https://open.kakao.com/o/suiGnD0", "lat": 35.2082050651349, "lng": 129.006965137504, "id": 37, "is_urgent": false, "urgent_msg": ""}, {"name": "HBÏïÑÏπ¥Îç∞ÎØ∏", "target": "Î¨¥Í¥Ä", "address": "ÏÑúÏö∏ ÎèÑÎ¥âÍµ¨ ÎÖ∏Ìï¥Î°ú 273", "schedule": "Ïõî 17:00-18:30 / Ïùº 15:00-16:30 / Ïùº 16:30-18:00", "price": "1Ìöå Î¨¥Î£åÏ≤¥Ìóò / ÌïôÏÉù 12ÎßåÏõê / ÏÑ±Ïù∏ 14ÎßåÏõê / Í∞úÏù∏Î†àÏä® Î¨∏Ïùò", "insta": "h_bacademy", "link": "https://m.blog.naver.com/rudejr2238", "lat": 37.6518477614279, "lng": 127.038744954072, "id": 38, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÎßàÏùåÎ°ú 284", "schedule": "Ìôî 19:00~22:00", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.519724340798, "lng": 127.236589788899, "id": 39, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÏÑ∏Ï¢ÖÎ°ú 941", "schedule": "Î™© 18:30~21:00", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.4877156432012, "lng": 127.243231178402, "id": 40, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÏïÑÎ¶ÑÎèô 804", "schedule": "Ïùº  9:00~12:00 (ÎÇ®) / 12:00~4:00 (Ïó¨)", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.523100478656, "lng": 127.255014907693, "id": 41, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏàúÏ≤úÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® ÏàúÏ≤úÏãú Î∂ÅÏ†ï2Í∏∏ 20", "schedule": "Ìôî 18:30~22:00", "price": "Ïõî 3.5ÎßåÏõê", "insta": "heooooooeh", "link": "", "lat": 34.9646430183578, "lng": 127.483992847829, "id": 42, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏàúÏ≤úÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® ÏàúÏ≤úÏãú ÏàúÍ¥ëÎ°ú 15", "schedule": "Í∏à 18:30~21:30", "price": "Ïõî 3.5ÎßåÏõê", "insta": "heooooooeh", "link": "", "lat": 34.9560628875777, "lng": 127.522478978541, "id": 43, "is_urgent": false, "urgent_msg": ""}, {"name": "Î™©Ìè¨ÌïòÎÇòÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® Î™©Ìè¨Ïãú ÎÇ®ÏïÖ1Î°ú16Î≤àÍ∏∏ 25", "schedule": "Ïõî 18:30~21:40 / Ïàò 18:30~21:40 / Í∏à 18:30~21:40", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ ÎπÑÏö© ÏóÜÏùå", "insta": "mokpo_hana_vc", "link": "", "lat": 34.8080460089449, "lng": 126.449995234402, "id": 44, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌïòÏù¥ÏõêÎ∞∞Íµ¨ÎèôÌò∏Ìöå", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÌïòÎÇ®Ïãú ÏïÑÎ¶¨ÏàòÎ°ú 600", "schedule": "Ìôî 10:00~12:00 / Ïàò 10:00~12:00 / Î™© 10:00~12:00", "price": "Ïõî 1ÎßåÏõê", "insta": "", "link": "https://www.daangn.com/kr/community/%ED%95%98%EB%82%A8%EC%8B%9C-%EC%97%AC%EC%9E%90-%EB%B0%B0%EA%B5%AC-%EB%8F%99%ED%98%B8%ED%9A%8C-54tne9r282sz/", "lat": 37.5657002161617, "lng": 127.193906244378, "id": 45, "is_urgent": false, "urgent_msg": ""}];

        async function checkDuplicateNickname(nickname) {
            if (!db) return false;
            const q = query(collection(db, "users"), where("full_nickname", "==", nickname));
            const querySnapshot = await getDocs(q);
            return !querySnapshot.empty; 
        }

        let currentUser = null;
        let currentProfileData = null;

        if (auth) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = user;
                    await loadOrCreateUserProfile(user);
                    updateProfileUI(true);
                } else {
                    currentUser = null;
                    currentProfileData = null;
                    updateProfileUI(false);
                }
            });
        }

        window.loginWithGoogle = async function() {
            if (!auth) return;
            const provider = new GoogleAuthProvider();
            try { await signInWithPopup(auth, provider); } catch (error) { alert("Î°úÍ∑∏Ïù∏ Ïã§Ìå®: " + error.message); }
        };

        window.registerWithEmail = async function() {
            const email = document.getElementById('emailInput').value;
            const pw = document.getElementById('pwInput').value;
            if(!email || !pw) { alert('Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
            try { await createUserWithEmailAndPassword(auth, email, pw); } catch(e) { alert(e.message); }
        };

        window.loginWithEmail = async function() {
            const email = document.getElementById('emailInput').value;
            const pw = document.getElementById('pwInput').value;
            if(!email || !pw) { alert('Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
            try { await signInWithEmailAndPassword(auth, email, pw); } catch(e) { alert(e.message); }
        };

        window.logout = function() {
            if (!auth) return;
            if(confirm("Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
                signOut(auth).then(() => {
                    document.getElementById('profileOverlay').style.display = 'none';
                    document.getElementById('lunchboxOverlay').style.display = 'none';
                });
            }
        };

        async function loadOrCreateUserProfile(user) {
            const userRef = doc(db, "users", user.uid);
            try {
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    currentProfileData = userSnap.data();
                } else {
                    let newNameObj = null; let isUnique = false; let retryCount = 0;
                    while (!isUnique && retryCount < 10) {
                        newNameObj = generateRiceName();
                        const isDup = await checkDuplicateNickname(newNameObj.full);
                        if (!isDup) isUnique = true; else retryCount++;
                    }
                    if (!isUnique) newNameObj.full += Date.now().toString().slice(-4);
                    const now = new Date();
                    const userData = { nickname: newNameObj.base, suffix: newNameObj.code, full_nickname: newNameObj.full, color: newNameObj.color, created_at: now, email: user.email, bookmarks: [] };
                    await setDoc(userRef, userData);
                    currentProfileData = userData;
                    alert("ÌôòÏòÅÌï©ÎãàÎã§! [" + newNameObj.full + "]ÎãòÏù¥ ÎêòÏÖ®ÏäµÎãàÎã§! üçö");
                }
                renderProfileCard();
            } catch (error) { console.error("DB Error:", error); }
        }

        function updateProfileUI(isLoggedIn) {
            const loginSection = document.getElementById('loginSection');
            const profileContent = document.getElementById('profileContent');
            if (isLoggedIn) {
                if(loginSection) loginSection.style.display = 'none';
                if(profileContent) profileContent.style.display = 'block';
            } else {
                if(loginSection) loginSection.style.display = 'flex';
                if(profileContent) profileContent.style.display = 'none';
            }
        }

        function renderProfileCard() {
            if (!currentProfileData) return;
            const card = document.getElementById('myProfileCard');
            const nicknameEl = document.getElementById('pcNickname');
            const dateEl = document.getElementById('pcDate');
            const mainTeamEl = document.getElementById('pcMainTeam');

            let bgColor = currentProfileData.color;
            if (!bgColor) {
                const riceName = currentProfileData.nickname || currentProfileData.full_nickname.split('-')[0];
                const found = riceData.find(r => r.name === riceName);
                bgColor = found ? found.color : "#fbc02d";
            }
            card.style.backgroundColor = bgColor;
            nicknameEl.innerText = currentProfileData.full_nickname;
            if (currentProfileData.created_at) {
                const d = new Date(currentProfileData.created_at.seconds * 1000);
                dateEl.innerText = "Í∞ÄÏûÖÏùº: " + d.getFullYear() + "." + (d.getMonth()+1) + "." + d.getDate();
            }
            const bookmarks = currentProfileData.bookmarks || [];
            if (bookmarks.length > 0) {
                const mainId = bookmarks[0];
                const mainTeam = allClubs.find(c => c.id === mainId);
                mainTeamEl.innerHTML = mainTeam ? "üèÜ " + mainTeam.name : "Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå";
            } else {
                mainTeamEl.innerText = "Ï∞úÌïú ÌåÄÏù¥ ÏóÜÏñ¥Ïöî";
            }
        }

        window.bookmarkTeam = async function(teamId) {
            if (!currentUser || !db) { alert("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú Í∏∞Îä•ÏûÖÎãàÎã§! üçö Î≤ÑÌäºÏùÑ ÎàåÎü¨ Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî."); return; }
            try {
                const userRef = doc(db, "users", currentUser.uid);
                let bookmarks = currentProfileData.bookmarks || [];
                if (bookmarks.includes(teamId)) { alert("Ïù¥ÎØ∏ ÎèÑÏãúÎùΩÏóê Îã¥Í∏¥ ÌåÄÏûÖÎãàÎã§! üç±"); return; }
                if (bookmarks.length >= 5) { alert("ÎèÑÏãúÎùΩÏù¥ ÍΩâ Ï∞ºÏäµÎãàÎã§! (ÏµúÎåÄ 5Í∞ú) üç±\nÍ∏∞Ï°¥ ÌåÄÏùÑ ÎπºÍ≥† Îã¥ÏïÑÏ£ºÏÑ∏Ïöî."); return; }
                await updateDoc(userRef, { bookmarks: arrayUnion(teamId) });
                if (!currentProfileData.bookmarks) currentProfileData.bookmarks = [];
                currentProfileData.bookmarks.push(teamId);
                alert("ÎèÑÏãúÎùΩÏóê ÌåÄÏùÑ Îã¥ÏïòÏäµÎãàÎã§! üç±");
                renderProfileCard(); 
            } catch (e) { alert("Ï∞úÌïòÍ∏∞ Ïã§Ìå®: " + e.message); }
        };

        window.openLunchbox = function() {
            if (!currentProfileData || !currentProfileData.bookmarks || currentProfileData.bookmarks.length === 0) { alert("ÎèÑÏãúÎùΩÏù¥ ÎπÑÏñ¥ÏûàÏñ¥Ïöî! ÌåÄ ÏÉÅÏÑ∏ÌôîÎ©¥ÏóêÏÑú [üç± Îã¥Í∏∞]Î•º ÎàåÎü¨Î≥¥ÏÑ∏Ïöî."); return; }
            const overlay = document.getElementById('lunchboxOverlay');
            const grid = document.getElementById('lunchboxGrid');
            grid.innerHTML = ""; 
            const bookmarks = currentProfileData.bookmarks; 
            const slots = [null, null, null, null, null];
            bookmarks.forEach((bid, idx) => { if (idx < 5) slots[idx] = bid; });
            for (let i = 0; i < 5; i++) {
                const teamId = slots[i];
                const div = document.createElement('div');
                div.className = 'lb-cell slot-' + i;
                if (teamId !== null) {
                    const team = allClubs.find(c => c.id === teamId);
                    if (team) {
                        div.innerText = team.name;
                        div.onclick = function() { overlay.style.display = 'none'; moveToTeamLocation(team.lat, team.lng); };
                        div.classList.add('filled');
                    }
                } else { div.innerText = "Îπà Ïπ∏"; div.classList.add('empty'); }
                grid.appendChild(div);
            }
            overlay.style.display = 'flex';
        };

        window.closeLunchbox = function() { document.getElementById('lunchboxOverlay').style.display = 'none'; };

        function moveToTeamLocation(lat, lng) {
            if (window.map && window.kakao) {
                const moveLatLon = new kakao.maps.LatLng(lat, lng);
                map.setLevel(4);
                map.panTo(moveLatLon);
            }
        }

        window.editNickname = async function() {
            if (!currentUser || !db) return;
            const currentName = document.getElementById('pcNickname').innerText;
            const newName = prompt("Î≥ÄÍ≤ΩÌï† ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (ÌïòÏù¥Ìîà Í∏àÏßÄ)", currentName);
            if (newName && newName.trim() !== "" && newName !== currentName) {
                if (newName.includes("-")) { alert("‚ö†Ô∏è ÎãâÎÑ§ÏûÑÏóê ÌïòÏù¥Ìîà(-)ÏùÄ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\nÌïòÏù¥ÌîàÏùÄ Ïò§ÏßÅ 'Î∞•ÏïÑÏ†ÄÏî®'Í∞Ä ÎûúÎç§ÏúºÎ°ú ÏßÄÏñ¥Ï§Ä Ïù¥Î¶ÑÏóêÎßå ÌóàÏö©Îê©ÎãàÎã§!"); return; }
                try {
                    const isDup = await checkDuplicateNickname(newName);
                    if (isDup) { alert("Ïù¥ÎØ∏ ÎàÑÍµ∞Í∞Ä ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î¶ÑÏûÖÎãàÎã§."); return; }
                    const userRef = doc(db, "users", currentUser.uid);
                    await updateDoc(userRef, { full_nickname: newName });
                    currentProfileData.full_nickname = newName;
                    renderProfileCard();
                    alert("ÎãâÎÑ§ÏûÑ Î≥ÄÍ≤Ω ÏôÑÎ£å! ü•Ñ");
                } catch (e) { alert("Ïò§Î•ò: " + e); }
            }
        };

        window.toggleProfileCard = function() {
            const overlay = document.getElementById('profileOverlay');
            overlay.style.display = (overlay.style.display === 'flex') ? 'none' : 'flex';
        };
    </script>

    <style>
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", "ÎßëÏùÄ Í≥†Îîï", sans-serif; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; background: #f8f9fa; }
        #map { width: 100%; height: 100%; }
        :root { 
            --white: #fff; 
            --brand-color: #fac710; 
            --urgent-color: #ff4757; 
            --shadow: 0 4px 10px rgba(0,0,0,0.1); 
            --today-color: #d35400; 
            --nurungji-dark: #6d4c41; 
            --nurungji-card: #fbc02d; 
        }
        
        /* [Í∏∞Ï°¥ UI Ïä§ÌÉÄÏùº] */
        .search-container { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 20; display: flex; background: white; border-radius: 12px; box-shadow: var(--shadow); height: 48px; align-items: center; padding: 0 5px; }
        .search-icon-box { width: 40px; display: flex; justify-content: center; align-items: center; font-size: 18px; color: #888; }
        .main-search-input { flex: 1; border: none; outline: none; font-size: 15px; height: 100%; background: transparent; }
        .separator { width: 1px; height: 20px; background: #eee; margin: 0 5px; }
        .filter-btn-icon { width: 48px; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 18px; color: #333; position: relative; }
        .filter-btn-icon:active { opacity: 0.5; }
        .filter-badge { position: absolute; top: 12px; right: 10px; width: 8px; height: 8px; background: #fac710; border-radius: 50%; display: none; }
        .filter-badge.active { display: block; }
        
        .urgent-ticker-bar { position: absolute; top: 70px; left: 15px; right: 15px; z-index: 18; height: 40px; background: rgba(255, 245, 245, 0.95); border: 1px solid rgba(255, 71, 87, 0.3); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); display: none; align-items: center; padding: 0 12px; overflow: hidden; will-change: top; }
        .ticker-icon { font-size: 18px; margin-right: 10px; animation: pulse 1.5s infinite; }
        .ticker-content { flex: 1; height: 100%; position: relative; overflow: hidden; }
        .ticker-list { list-style: none; margin: 0; padding: 0; position: absolute; width: 100%; top: 0; left: 0; transition: top 0.5s ease-in-out; }
        .ticker-item { height: 40px; line-height: 40px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 14px; font-weight: 600; cursor: pointer; color: #333; }
        .ticker-item b { color: #d63031; margin-right: 5px; }

        .fab-group { position: absolute; bottom: 30px; right: 15px; z-index: 20; display: flex; flex-direction: column; gap: 12px; }
        .fab-btn { width: 50px; height: 50px; background: white; border-radius: 50%; box-shadow: var(--shadow); display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 20px; text-decoration: none; color: #333; transition: transform 0.2s; }
        .fab-btn:active { transform: scale(0.95); }
        .fab-report { background: #fac710; color: #000; }
        .fab-urgent { background: var(--urgent-color); color: #fff; border: 2px solid #fff; font-size: 24px; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4); }
        
        /* [NEW] ÌîÑÎ°úÌïÑ & ÎèÑÏãúÎùΩ Î≤ÑÌäº */
        .fab-profile { position: absolute; bottom: 30px; left: 15px; z-index: 20; width: 55px; height: 55px; background: #fff; border-radius: 50%; box-shadow: var(--shadow); display: flex; justify-content: center; align-items: center; font-size: 30px; cursor: pointer; border: 2px solid #eee; transition: transform 0.2s; }
        .fab-profile:active { transform: scale(0.95); }
        .fab-lunchbox { position: absolute; bottom: 100px; left: 15px; z-index: 20; width: 50px; height: 50px; background: #fff; border-radius: 50%; box-shadow: var(--shadow); display: flex; justify-content: center; align-items: center; font-size: 26px; cursor: pointer; border: 1px solid #eee; transition: transform 0.2s; }
        .fab-lunchbox:active { transform: scale(0.95); }

        /* [NEW] Ïò§Î≤ÑÎ†àÏù¥ Ïä§ÌÉÄÏùº (ÌîÑÎ°úÌïÑ/Î°úÍ∑∏Ïù∏/ÎèÑÏãúÎùΩ) */
        .profile-overlay, .lunchbox-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 500; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .profile-card { width: 80%; max-width: 320px; background: var(--nurungji-card); padding: 30px 20px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.2); position: relative; border: 8px dashed rgba(255,255,255,0.9); border-radius: 40px; background-clip: padding-box; }
        .pc-header { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 5px; }
        .pc-nickname { color: #fff; font-size: 24px; font-weight: 800; text-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .pc-edit-btn { cursor: pointer; font-size: 18px; background: rgba(255,255,255,0.4); width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .pc-date { color: rgba(255,255,255,0.95); font-size: 12px; font-weight: 600; margin-bottom: 10px; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .pc-divider { height: 2px; background: rgba(255,255,255,0.5); width: 50%; margin: 10px auto; border-radius: 1px; }
        .pc-main-team { color: #fff; font-size: 20px; font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.2); margin-top: 5px; }
        
        .login-section { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .auth-input { padding: 10px 15px; border-radius: 20px; border: none; outline: none; font-size: 14px; background: rgba(255,255,255,0.9); }
        .btn-row { display: flex; gap: 8px; }
        .btn-auth { flex: 1; padding: 10px; border-radius: 20px; border: none; cursor: pointer; font-weight: 700; font-size: 13px; color: #555; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-google-login { background: white; color: #555; border: 1px solid #ddd; padding: 12px 20px; border-radius: 30px; font-weight: 700; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-google-login img { width: 18px; height: 18px; }
        .btn-logout { margin-top: 20px; background: transparent; border: 1px solid rgba(255,255,255,0.5); color: white; padding: 5px 10px; border-radius: 12px; font-size: 12px; cursor: pointer; }
        .divider { color: rgba(255,255,255,0.8); font-size: 11px; margin: 10px 0; display: flex; align-items: center; gap: 10px; }
        .divider::before, .divider::after { content: ""; flex: 1; height: 1px; background: rgba(255,255,255,0.5); }

        .lunchbox-grid { width: 320px; height: 180px; background: #fff8e1; border: 4px solid #8d6e63; border-radius: 12px; display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: 1fr 1fr; gap: 2px; padding: 2px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .lb-cell { background: #fff; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: 700; color: #555; text-align: center; padding: 4px; cursor: pointer; transition: background 0.1s; border: 1px solid #e0e0e0; }
        .lb-cell:active { background: #eee; }
        .lb-cell.empty { color: #ccc; font-weight: 400; }
        .lb-cell.filled { background: #fffde7; border-color: var(--brand-color); }
        .slot-2 { grid-row: 1; grid-column: 1 / span 2; } 
        .slot-3 { grid-row: 1; grid-column: 3 / span 2; } 
        .slot-4 { grid-row: 1; grid-column: 5 / span 2; } 
        .slot-0 { grid-row: 2; grid-column: 1 / span 3; } 
        .slot-1 { grid-row: 2; grid-column: 4 / span 3; } 

        /* ÏßÄÎèÑ ÎßàÏª§ Î∞è ÎùºÎ≤® */
        .label { padding: 6px 12px; background-color: #fff; border-radius: 20px; font-size: 12px; font-weight: 800; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: 1px solid rgba(0,0,0,0.1); white-space: nowrap; cursor: pointer; transform: translateY(-55px); }
        .label:hover { z-index: 10000 !important; transform: translateY(-57px) scale(1.05); }
        .label.urgent { background-color: var(--urgent-color); color: #fff; border: 2px solid #fff; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 71, 87, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); } }

        /* Î∞îÌÖÄ ÏãúÌä∏ */
        .bottom-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; z-index: 200; border-top-left-radius: 24px; border-top-right-radius: 24px; box-shadow: 0 -5px 25px rgba(0,0,0,0.15); display: flex; flex-direction: column; transition: height 0.1s linear; height: 0; overflow: hidden; }
        .sheet-handle-area { width: 100%; padding: 10px 0; display: flex; justify-content: center; cursor: grab; flex-shrink: 0; background: #fff; }
        .sheet-handle { width: 36px; height: 4px; background: #e5e5e5; border-radius: 2px; }
        .sheet-content-wrapper { flex: 1; overflow-y: auto; padding: 0 24px 20px 24px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .sheet-content-wrapper::-webkit-scrollbar { display: none; }

        .urgent-banner { margin-bottom: 15px; padding: 12px; background: #fff5f5; border: 1px solid #ff8787; border-radius: 12px; color: #c92a2a; font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px; line-height: 1.4; }
        .sheet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; margin-top: 10px; }
        .sheet-title { font-size: 22px; font-weight: 800; color: #111; margin: 0; display: flex; align-items: center; gap: 8px; flex: 1; }
        .instagram { font-size: 26px; width: 1em; height: 1em; display: inline-grid; place-items: center; vertical-align: middle; background: radial-gradient(circle farthest-corner at 28% 100%, #fcdf8f 0%, #fbd377 10%, #fa8e37 22%, #f73344 35%, transparent 65%), linear-gradient(145deg, #3051f1 10%, #c92bb7 70%); border-radius: 0.25em; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
        .instagram:before { content: ""; position: absolute; border-radius: inherit; aspect-ratio: 1; border: 0.08em solid var(--white); width: 65%; height: 65%; border-radius: 25%; }
        .instagram:after { content: ""; position: absolute; border-radius: 50%; aspect-ratio: 1; border: 0.08em solid var(--white); width: 35%; height: 35%; box-shadow: 0.22em -0.22em 0 -0.18em var(--white); }

        /* ÌÉÄÏûÑÌÖåÏù¥Î∏î Í¥ÄÎ†® Ïä§ÌÉÄÏùº (Í∏∞Ï°¥ Í∏∞Îä• Ïú†ÏßÄ) */
        .time-morph-container { position: relative; background: transparent; margin-bottom: 20px; transition: height 0.1s linear; overflow: hidden; min-height: 60px; border: none; }
        .st-bubble { background: #fff; border-radius: 8px; padding: 8px 14px; font-size: 13px; color: #333; white-space: nowrap; font-weight: 600; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid var(--brand-color); box-shadow: 0 0 8px rgba(250, 199, 16, 0.4); flex-shrink: 0; }
        .st-day-text { font-size: 12px; color: var(--brand-color); font-weight: 800; margin-bottom: 2px; }
        .st-time-text { font-size: 14px; font-weight: 700; color: #333; }
        .summary-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; gap: 8px; overflow-x: auto; align-items: center; padding: 5px; scrollbar-width: none; opacity: 1; transition: opacity 0.1s; z-index: 10; }
        .summary-content::-webkit-scrollbar { display: none; }
        .full-content { position: absolute; top: 0; left: 0; width: 100%; opacity: 0; transition: opacity 0.1s; z-index: 5; }
        
        .ft-container { display: flex; flex-direction: column; background: #fff; border-radius: 12px; overflow: hidden; border: 1px solid #f0f0f0; }
        .ft-header-row-flex { display: flex; height: 35px; border-bottom: 1px solid #eee; }
        .ft-header-cell { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #888; font-weight: 600; background: #fafafa; }
        .ft-header-cell.time-col { width: 50px; flex: none; border-right: 1px solid #eee; }
        .ft-header-cell.today { background: var(--today-color); color: #fff; font-weight: 800; }
        .ft-body { display: flex; position: relative; }
        .ft-col-time { width: 50px; flex: none; display: flex; flex-direction: column; border-right: 1px solid #eee; background: #fafafa; }
        .ft-time-label { display: flex; flex-direction: row; gap: 2px; align-items: center; justify-content: center; font-size: 11px; color: #999; font-weight: 500; border-bottom: 1px solid #f5f5f5; white-space: nowrap; }
        .ft-col-day { flex: 1; position: relative; border-right: 1px solid #f8f8f8; }
        .ft-col-day:last-child { border-right: none; }
        .ft-event-block { position: absolute; width: 94%; left: 3%; background: rgba(250, 199, 16, 0.25); border-left: 3px solid var(--brand-color); border-radius: 4px; font-size: 10px; color: #555; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; font-weight: 700; line-height: 1.2; z-index: 5; box-shadow: 0 2px 4px rgba(0,0,0,0.05); padding: 2px; overflow: hidden; }

        .tag-box { display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
        .tag { font-size: 12px; padding: 6px 10px; border-radius: 8px; font-weight: 600; color: #555; background: #f1f3f5; }
        .tag.target { color: #0056b3; background: #e7f5ff; }
        .info-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; font-size: 15px; color: #333; }
        .info-icon { width: 20px; text-align: center; font-size: 16px; }
        .action-buttons { display: flex; gap: 12px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border-radius: 14px; border: none; font-size: 15px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 6px; text-decoration: none; transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn-copy { background: #f1f3f5; color: #333; }
        .btn-way { background: var(--brand-color); color: #000; box-shadow: 0 4px 10px rgba(250, 199, 16, 0.3); }
        a.insta-link { text-decoration: none; display: flex; align-items: center; }

        /* ÌïÑÌÑ∞ ÏãúÌä∏ */
        .filter-sheet { position: fixed; top: 0; left: 0; width: 100%; max-height: 85%; background: #fff; z-index: 300; border-radius: 0 0 24px 24px; box-shadow: 0 5px 30px rgba(0,0,0,0.2); padding: 0; transform: translateY(-100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); display: flex; flex-direction: column; will-change: transform; }
        .filter-sheet.active { transform: translateY(0); }
        .fs-header { padding: 20px 24px 15px; display: flex; justify-content: space-between; align-items: center; }
        .fs-title { font-size: 20px; font-weight: 800; }
        .fs-body { flex: 1; overflow-y: auto; padding: 0 24px 10px; }
        .fs-section { margin-bottom: 25px; }
        .fs-label { font-size: 14px; font-weight: 700; color: #888; margin-bottom: 10px; display: block; }
        .chip-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip { padding: 8px 16px; border-radius: 20px; border: 1px solid #e0e0e0; background: #fff; font-size: 14px; color: #555; font-weight: 600; cursor: pointer; transition: all 0.2s; user-select: none; }
        .chip:hover { background: #f8f9fa; }
        .chip.selected { background: var(--brand-color); color: #000; border-color: var(--brand-color); box-shadow: 0 2px 6px rgba(250, 199, 16, 0.3); font-weight: 700; }
        .fs-footer { padding: 10px 24px 10px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; }
        .btn-reset { flex: 0.3; background: #f1f3f5; color: #555; }
        .btn-apply { flex: 1; background: #333; color: white; }
        .fs-handle-area { width: 100%; padding: 10px 0 20px 0; display: flex; justify-content: center; cursor: grab; background: white; border-radius: 0 0 24px 24px; }
        .fs-handle { width: 40px; height: 5px; background: #e5e5e5; border-radius: 3px; }
        
        .expand-hint { text-align: center; color: #ccc; font-size: 11px; margin-top: 5px; margin-bottom: 0px; }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="search-container">
        <div class="search-icon-box">üîé</div>
        <input type="text" id="topSearchInput" class="main-search-input" placeholder="ÌåÄÎ™Ö, ÏßÄÏó≠ÏúºÎ°ú Í≤ÄÏÉâ..." onkeyup="applyFilters()">
        <div class="separator"></div>
        <div class="filter-btn-icon" onclick="openFilterSheet()">‚öôÔ∏è<div id="filterBadge" class="filter-badge"></div></div>
    </div>

    <div id="urgentTicker" class="urgent-ticker-bar">
        <div class="ticker-icon">üî•</div>
        <div class="ticker-content">
            <ul id="tickerList" class="ticker-list"></ul>
        </div>
    </div>

    <div class="fab-lunchbox" onclick="openLunchbox()">üç±</div>
    <div class="fab-profile" onclick="toggleProfileCard()">üçö</div>

    <div class="fab-group">
        <a href="https://forms.gle/PiNXA5QkxKoPQyix6" target="_blank" class="fab-btn fab-urgent" title="Ïã≠ÏãúÏùºÎ∞ò Í∏¥Í∏âÍµ¨Ïù∏ Ïã†Ï≤≠">ü•Ñ</a>
        <a href="https://forms.gle/H6HoEUy5zM7FHuHL7" target="_blank" class="fab-btn fab-report" title="ÌåÄ Ï†úÎ≥¥ÌïòÍ∏∞">üì¢</a>
        <div class="fab-btn" onclick="moveToMyLocation()">üìç</div>
    </div>

    <div id="lunchboxOverlay" class="lunchbox-overlay" onclick="closeLunchbox()">
        <div class="lunchbox-grid" id="lunchboxGrid" onclick="event.stopPropagation()"></div>
    </div>

    <div id="profileOverlay" class="profile-overlay" onclick="toggleProfileCard()">
        <div class="profile-card" id="myProfileCard" onclick="event.stopPropagation()">
            <div id="loginSection" class="login-section">
                <button class="btn-google-login" onclick="loginWithGoogle()">
                    <img src="https://fonts.gstatic.com/s/i/productlogos/googleg/v6/24px.svg" alt="G">
                    Íµ¨Í∏ÄÎ°ú Í∞ÑÌé∏ Î°úÍ∑∏Ïù∏
                </button>
                <div class="divider">ÎòêÎäî</div>
                <div class="input-group">
                    <input type="email" id="emailInput" class="auth-input" placeholder="Ïù¥Î©îÏùº ÏûÖÎ†•">
                    <input type="password" id="pwInput" class="auth-input" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ (6ÏûêÎ¶¨ Ïù¥ÏÉÅ)">
                </div>
                <div class="btn-row">
                    <button class="btn-auth primary" onclick="loginWithEmail()">Î°úÍ∑∏Ïù∏</button>
                    <button class="btn-auth secondary" onclick="registerWithEmail()">ÌöåÏõêÍ∞ÄÏûÖ</button>
                </div>
            </div>
            <div id="profileContent" style="display:none;">
                <div class="pc-header">
                    <span id="pcNickname" class="pc-nickname">...</span>
                    <div class="pc-edit-btn" onclick="editNickname()">ü•¢</div>
                </div>
                <div id="pcDate" class="pc-date">Í∞ÄÏûÖÏùº: -</div>
                <div class="pc-divider"></div>
                <div id="pcMainTeam" class="pc-main-team">Ï∞úÌïú ÌåÄÏù¥ ÏóÜÏñ¥Ïöî</div>
                <button class="btn-logout" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
    </div>

    <div id="filterSheet" class="filter-sheet">
        <div class="fs-header"><div class="fs-title">Í≤ÄÏÉâ Ï°∞Í±¥ ÏÑ§Ï†ï</div></div>
        <div class="fs-body">
            <div class="fs-section"><span class="fs-label">üìç ÏßÄÏó≠ (Ï§ëÎ≥µ ÏÑ†ÌÉù Í∞ÄÎä•)</span>
                <div class="chip-group" id="regionChips">
                    <div class="chip" onclick="toggleFilter('region', 'ÏÑúÏö∏', this)">ÏÑúÏö∏</div>
                    <div class="chip" onclick="toggleFilter('region', 'Í≤ΩÍ∏∞', this)">Í≤ΩÍ∏∞</div>
                    <div class="chip" onclick="toggleFilter('region', 'Ïù∏Ï≤ú', this)">Ïù∏Ï≤ú</div>
                    <div class="chip" onclick="toggleFilter('region', 'Í∞ïÏõê', this)">Í∞ïÏõê</div>
                    <div class="chip" onclick="toggleFilter('region', 'Ï∂©Ï≤≠', this)">Ï∂©Ï≤≠</div>
                    <div class="chip" onclick="toggleFilter('region', 'Ï†ÑÎùº', this)">Ï†ÑÎùº</div>
                    <div class="chip" onclick="toggleFilter('region', 'Í≤ΩÏÉÅ', this)">Í≤ΩÏÉÅ</div>
                    <div class="chip" onclick="toggleFilter('region', 'Ï†úÏ£º', this)">Ï†úÏ£º</div>
                </div>
            </div>
            <div class="fs-section"><span class="fs-label">üìÖ ÏöîÏùº</span>
                <div class="chip-group" id="dayChips">
                    <div class="chip" onclick="toggleFilter('day', 'Ïõî', this)">Ïõî</div>
                    <div class="chip" onclick="toggleFilter('day', 'Ìôî', this)">Ìôî</div>
                    <div class="chip" onclick="toggleFilter('day', 'Ïàò', this)">Ïàò</div>
                    <div class="chip" onclick="toggleFilter('day', 'Î™©', this)">Î™©</div>
                    <div class="chip" onclick="toggleFilter('day', 'Í∏à', this)">Í∏à</div>
                    <div class="chip" onclick="toggleFilter('day', 'ÌÜ†', this)">ÌÜ†</div>
                    <div class="chip" onclick="toggleFilter('day', 'Ïùº', this)">Ïùº</div>
                </div>
            </div>
            <div class="fs-section"><span class="fs-label">üèê ÎåÄÏÉÅ Î∞è ÌäπÏßï</span>
                <div class="chip-group" id="targetChips">
                    <div class="chip" onclick="toggleFilter('target', 'ÏÑ±Ïù∏', this)">ÏÑ±Ïù∏</div>
                    <div class="chip" onclick="toggleFilter('target', 'ÎåÄÌïôÏÉù', this)">ÎåÄÌïôÏÉù</div>
                    <div class="chip" onclick="toggleFilter('target', 'Ï≤≠ÏÜåÎÖÑ', this)">Ï≤≠ÏÜåÎÖÑ</div>
                    <div class="chip" onclick="toggleFilter('target', 'Ïó¨ÏÑ±Ï†ÑÏö©', this)">Ïó¨ÏÑ±Ï†ÑÏö©</div>
                    <div class="chip" onclick="toggleFilter('target', 'ÎÇ®ÏÑ±Ï†ÑÏö©', this)">ÎÇ®ÏÑ±Ï†ÑÏö©</div>
                    <div class="chip" onclick="toggleFilter('target', 'ÏÑ†Ï∂úÍ∞ÄÎä•', this)">ÏÑ†Ï∂úÍ∞ÄÎä•</div>
                    <div class="chip" onclick="toggleFilter('target', '6Ïù∏Ï†ú', this)">6Ïù∏Ï†ú</div>
                </div>
            </div>
        </div>
        <div class="fs-footer">
            <div class="btn btn-reset" onclick="resetFilters()">Ï¥àÍ∏∞Ìôî</div>
            <div class="btn btn-apply" onclick="applyFilters()">Ï†ÅÏö©ÌïòÍ∏∞</div>
        </div>
        <div class="fs-handle-area" id="filterHandle"><div class="fs-handle"></div></div>
    </div>

    <div id="bottomSheet" class="bottom-sheet">
        <div class="sheet-handle-area" id="sheetHandle"><div class="sheet-handle"></div></div>
        
        <div class="sheet-content-wrapper">
            <div id="urgentArea"></div>

            <div class="sheet-header">
                <div class="sheet-title" id="sheetTitle">ÌåÄ Ïù¥Î¶Ñ</div>
                <div id="btnBookmark" style="font-size:24px; cursor:pointer;" onclick="">üç±</div>
            </div>
            
            <div class="time-morph-container" id="timeMorphContainer" onclick="toggleTimeExpand()">
                <div class="summary-content" id="summaryContent"></div>
                <div class="full-content" id="fullContent"></div>
            </div>
            
            <div class="tag-box" id="sheetTags"></div>
            <div class="info-row"><span class="info-icon">üí∞</span> <span id="sheetPrice">-</span></div>
            
            <div class="action-buttons">
                <button class="btn btn-copy" id="btnCopy">üìç Ï£ºÏÜå Î≥µÏÇ¨</button>
                <a href="#" target="_blank" class="btn btn-way" id="btnWay">üöÄ Í∏∏Ï∞æÍ∏∞</a>
            </div>
            
            <div class="expand-hint" id="expandHint">‚ñ¥ ÏúÑÎ°ú Ïò¨Î†§ÏÑú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î≥¥Í∏∞</div>
            <input type="hidden" id="sheetAddressVal">
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=69f821ba943db5e3532ac90ea5ca1080&libraries=clusterer"></script>
    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = { center: new kakao.maps.LatLng(37.5409675314785, 127.100704228215), level: 8 }; 
        var map = new kakao.maps.Map(mapContainer, mapOption); 
        
        var clusterer = new kakao.maps.MarkerClusterer({
            map: map, averageCenter: true, minLevel: 6,
            styles: [{
                width: '40px', height: '40px', background: '#fac710', borderRadius: '50%', color: '#000', textAlign: 'center', fontWeight: 'bold', lineHeight: '40px', boxShadow: '0 2px 6px rgba(0,0,0,0.3)', fontSize: '14px'
            }]
        });

        // ÌÅ¥ÎüΩ Îç∞Ïù¥ÌÑ∞ Ï£ºÏûÖ
        var clubs = [{"name": "GVT", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ÌäπÎ≥ÑÏãú Í¥ëÏßÑÍµ¨ ÏïÑÏ∞®ÏÇ∞Î°ú70Í∏∏ 35", "schedule": "ÌÜ† 13:00~17:00", "price": "Ïõî 3ÎßåÏõê (ÌïôÏÉù 2ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gvt__official", "link": "", "lat": 37.5409675314785, "lng": 127.100704228215, "id": 0, "is_urgent": true, "urgent_msg": "üîπ ÎÇ®ÏûêÎ∂Ä Î™®ÏßëÏ§ë‚Äº Í≤åÏä§Ìä∏ ÌôòÏòÅ‚Äº üîπ"}, {"name": "Î∏åÏù¥ÌôÄÎ¶≠", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ÎèÑ ÏÑ±ÎÇ®Ïãú Î∂ÑÎãπÍµ¨ ÏñëÌòÑÎ°ú 262", "schedule": "Ìôî 19:00~22:00 / Í∏à 19:00~22:00 / Ïùº 14:00~18:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "v_holic_2010", "link": "", "lat": 37.4073263996148, "lng": 127.126612716157, "id": 1, "is_urgent": false, "urgent_msg": ""}, {"name": "H_B", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÍ∏∞ÎèÑ ÏàòÏõêÏãú Ïû•ÏïàÍµ¨ ÏàòÏùºÎ°ú233Î≤àÍ∏∏ 15", "schedule": "Ïàò 18:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê (Ïã∏Îã§Ïã∏!)", "insta": "hb_volleyball_club", "link": "http://www.hb-volleyball.co.kr", "lat": 37.3073441859489, "lng": 127.015667305962, "id": 2, "is_urgent": false, "urgent_msg": ""}, {"name": "H_B", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÍ∏∞ÎèÑ ÌôîÏÑ±Ïãú Îß§ÏÜ°Î©¥ Îß§ÏÜ°Î°ú 41", "schedule": "ÌÜ† 18:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê (Ïã∏Îã§Ïã∏!)", "insta": "hb_volleyball_club", "link": "http://www.hb-volleyball.co.kr", "lat": 37.2518258783031, "lng": 126.909629549921, "id": 3, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎèôÎëêÏ≤úÌôîÎ™©Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ÎèÑ ÎèôÎëêÏ≤úÏãú Ïñ¥ÏàòÎ°ú 4", "schedule": "Ïõî 19:30~22:00 / Ïàò 19:30~22:00 / Í∏à 19:30~22:00", "price": "Ïõî 1ÎßåÏõê", "insta": "ddc_voller", "link": "https://open.kakao.com/o/p10jZzWh", "lat": 37.9052629454328, "lng": 127.043063227981, "id": 4, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌåÄÌÅêÎ∏å", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, (Ïó¨ÏÑ±Ï†ÑÏö©, 6Ïù∏Ï†ú)", "address": "ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÏÇºÏÑ±Î°ú135Í∏∏ 42", "schedule": "Ïõî 19:00~21:00 / Ïàò 19:00~21:00", "price": "Ïõî 6.5ÎßåÏõê(Ï£º2Ìöå 11ÎßåÏõê) / Í≤åÏä§Ìä∏ 2.5ÎßåÏõê", "insta": "teamcubevc", "link": "", "lat": 37.520125172379, "lng": 127.044715764538, "id": 5, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ±Î∂ÅSVA", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "ÏÑúÏö∏ ÏÑ±Î∂ÅÍµ¨ ÌôîÎûëÎ°ú13Í∏∏ 144", "schedule": "Ìôî 19:00~22:00 / Î™© 19:00~22:00", "price": "Ïõî 8ÎßåÏõê", "insta": "kr_sports_plus", "link": "", "lat": 37.6085494620429, "lng": 127.042324971736, "id": 6, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎùºÏù¥ÌÅ¨Î∞úÎ¶¨Î≥º", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ïù∏Ï≤ú ÎØ∏Ï∂îÌôÄÍµ¨ ÏÑùÏ†ïÎ°ú 165", "schedule": "ÌÜ† 12:30~16:30", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "likevolleyball_team", "link": "", "lat": 37.4739644136398, "lng": 126.651978806147, "id": 7, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎùºÏù¥ÌÅ¨Î∞úÎ¶¨Î≥º", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ïù∏Ï≤ú ÏÑúÍµ¨ ÌïúÏ§ëÎ°ú 25", "schedule": "Ïàò 18:00~21:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "likevolleyball_team", "link": "", "lat": 37.5795849502601, "lng": 126.672802385687, "id": 8, "is_urgent": false, "urgent_msg": ""}, {"name": "JKÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏãúÌù•Ïãú Ïû•Í≥°Î°ú 10", "schedule": "Ïùº 10:00~13:00", "price": "ÌöåÎπÑ3Îßå / Í≤åÏä§Ìä∏ÎπÑ ÏóÜÏùå", "insta": "", "link": "https://m.cafe.daum.net/volleyballsok/IfzY/3333?searchView=Y", "lat": 37.3798358362533, "lng": 126.787616614841, "id": 9, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÉàÎ°ú(CERO)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ Í∞ïÎèôÍµ¨ ÏÉÅÏùºÎ°ú12Í∏∏ 56", "schedule": "ÌÜ† 14:00~17:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "cero_vc", "link": "", "lat": 37.5556127825867, "lng": 127.174608361426, "id": 10, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎßàÏÇ∞Î≤†Ïä§Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÎÇ® Ï∞ΩÏõêÏãú ÎßàÏÇ∞ÌöåÏõêÍµ¨ ÌåîÏö©Î°ú 280", "schedule": "Ìôî 19:00~21:00 / Î™© 19:00~21:00", "price": "Ïõî3ÎßåÏõê", "insta": "masan_best", "link": "", "lat": 35.248323558591, "lng": 128.602594607144, "id": 11, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎåÄÍµ¨ NTC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, (ÏÑ†Ï∂úÍ∞ÄÎä•, Íµ∞ÎØ∏ÌïÑ ÏÉÅÍ¥Äx)", "address": "ÎåÄÍµ¨ Îã¨ÏÑúÍµ¨ Í≥ÑÎåÄÎèôÎ¨∏Î°ú3Í∏∏ 46", "schedule": "Ïõî 18:30~21:30 / Ïàò 18:30~21:30 / Î™© 18:30~21:30", "price": "Ïõî3ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ x", "insta": "ntc_volleyball", "link": "", "lat": 35.8579351866729, "lng": 128.494745397447, "id": 12, "is_urgent": false, "urgent_msg": ""}, {"name": "Í¥ëÎ™ÖÏÑ†Ïö∞", "target": "Î¨¥Í¥Ä", "address": "Í≤ΩÍ∏∞ Í¥ëÎ™ÖÏãú Í∞ÄÎ¶ºÎ°ú 18 ÌïòÏïàÎ∂ÅÏ¥àÎì±ÌïôÍµê", "schedule": "Ïùº 13:00~17:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "volleyball_sunwoo", "link": "", "lat": 37.4647085135351, "lng": 126.869134235278, "id": 13, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïö∞Î¶¨ÌïòÎ™®Îãà", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù (Ïó¨ÏÑ±Ï†ÑÏö©)", "address": "ÏÑúÏö∏ ÏñëÏ≤úÍµ¨ ÎÇ®Î∂ÄÏàúÌôòÎ°ú 380", "schedule": "ÌÜ† 14:00~18:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "harmony__volleyball", "link": "", "lat": 37.5326758132814, "lng": 126.828972567552, "id": 14, "is_urgent": false, "urgent_msg": ""}, {"name": "FAV", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ÎèÑ Í≥†ÏñëÏãú ÏùºÏÇ∞ ÏÑúÍµ¨ ÏÜ°Ìè¨Î∞±ÏÜ°Í∏∏ 70-1", "schedule": "Ïõî 19:40~21:30 / Ìôî 19:40~21:30 / Ïàò 19:40~21:30 / Î™© 19:40~21:30 / Í∏à 19:40~21:30", "price": "ÏÑ±Ïù∏ Ïõî Í∏∞Ï§Ä - Ï£º 1Ìöå 14ÎßåÏõê, Ï£º 2~3Ìöå 19ÎßåÏõê", "insta": "favclub.official", "link": "http://litt.ly/fav_volleyball", "lat": 37.6929835875228, "lng": 126.736120374622, "id": 15, "is_urgent": false, "urgent_msg": ""}, {"name": "Íµ¨ÎØ∏ Í±∞Î∂ÅÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Î¨¥Í¥Ä (ÏÑ†Ï∂úÍ∞ÄÎä•)", "address": "Í≤ΩÎ∂Å Íµ¨ÎØ∏Ïãú ÌòïÍ≥°Î°ú14Í∏∏ 5-20", "schedule": "Ìôî 18:30~21:30 / ÌÜ† 14:00~17:30", "price": "Ïõî 2ÎßåÏõê", "insta": "volleyball_gumi", "link": "https://m.cafe.naver.com/geobukclub.cafe?utm_source=ig&utm_medium=social&utm_content=link_in_bio&fbclid=PAb21jcAOw3JBleHRuA2FlbQIxMQBzcnRjBmFwcF9pZA81NjcwNjczNDMzNTI0MjcAAact0OTzvMhVFL7QPLtsO9AWmiWgTsYPFoXQoegc5zLSWZD2Xd0HgqvY9Fs8Sg_aem_zOfY0iLzVbb2vT-dMgNk2Q", "lat": 36.1147023025135, "lng": 128.329775063006, "id": 16, "is_urgent": false, "urgent_msg": ""}, {"name": "Í∞ïÏÑúVC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ Í∞ïÏÑúÍµ¨ Îì±Ï¥åÎ°ú39Í∏∏ 71", "schedule": "Ïàò 18:00~21:00 / ÌÜ† 15:00~18:00", "price": "Î∂ÑÍ∏∞ 8ÎßåÏõê(ÌïôÏÉù 5ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gangseo.vc", "link": "", "lat": 37.5476142187642, "lng": 126.857942163854, "id": 17, "is_urgent": false, "urgent_msg": ""}, {"name": "Î†àÎìúÌå°Ïä§", "target": "ÏÑ±Ïù∏", "address": "ÏÑúÏö∏ ÎÖ∏ÏõêÍµ¨ ÏÑ¨Î∞≠Î°ú 181", "schedule": "Î™© 18:00~21:00 / Ïùº 16:30~19:30", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 8Ï≤úÏõê", "insta": "", "link": "https://www.daangn.com/kr/group/%EB%B0%B0%EA%B5%AC%EB%8F%99%ED%98%B8%ED%9A%8C-%EB%A0%88%EB%93%9C%ED%8C%A1%EC%8A%A4-2wq9tjryem95/", "lat": 37.632255170053, "lng": 127.066056635951, "id": 18, "is_urgent": false, "urgent_msg": ""}, {"name": "Ï†ïÎ¨¥Î∞∞Íµ¨", "target": "Î¨¥Í¥Ä", "address": "Ï†ÑÎ∂Å Ï†ÑÏ£ºÏãú ÎçïÏßÑÍµ¨ ÎßåÏÑ±Î∂Å4Í∏∏ 10", "schedule": "Ïàò 19:00~21:00 / Î™© 19:00~21:00", "price": "Ï£º1Ìöå Ïõî 5ÎßåÏõê, Ï£º2Ìöå Ïõî 7ÎßåÏõê", "insta": "jeongmu_volley", "link": "", "lat": 35.8477726720349, "lng": 127.074701125365, "id": 19, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏïàÏÑ± ÎÑòÎ≤ÑÎÇòÏù∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú ÎπÑÎ£°Î°ú 78", "schedule": "Ïàò 19:00~21:40", "price": "", "insta": "anseong_no9_volleyballclub", "link": "https://www.youtube.com/@%EC%95%88%EC%84%B1%EB%84%98%EB%B2%84%EB%82%98%EC%9D%B89", "lat": 37.015078008763, "lng": 127.263020902801, "angle": 0.0, "id": 20, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌïòÏù¥Î∞úÎ¶¨", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú Îã§Ïú®Î°ú30", "schedule": "Ïàò 19:00~21:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "high.volley", "link": "", "lat": 37.7379799283829, "lng": 126.726930320218, "id": 21, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏûÑÌå©Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú ÏõîÎ°±Î©¥ Ìú¥ÏïîÎ°ú 434", "schedule": "Î™© 19:00~22:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "paju_impact", "link": "http://kko.to/7v33m3qZj", "lat": 37.8300288380237, "lng": 126.781056138359, "id": 22, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏûÑÌå©Ìä∏", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ", "address": "Í≤ΩÍ∏∞ ÌååÏ£ºÏãú Ìï¥ÏÜîÎ°ú 60", "schedule": "ÌÜ† 13:00~17:00", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "paju_impact", "link": "http://kko.to/7v33m3qZj", "lat": 37.7274642059342, "lng": 126.745874918567, "id": 23, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏïàÏÑ±MVP", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú Í≥µÎèÑÏùç Í∏∞ÏóÖÎã®ÏßÄÎ°ú 57", "schedule": "Ìôî 19:00~21:30 / Î™© 19:00~21:30", "price": "Ïõî 3ÎßåÏõê", "insta": "mvp_official_2014", "link": "https://open.kakao.com/o/s8T9ZYWe", "lat": 37.0028098402492, "lng": 127.15850296807, "id": 24, "is_urgent": false, "urgent_msg": ""}, {"name": "ÎåÄÍµ¨ ÎëêÎ•òÎ∞∞Íµ¨Ìöå", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ, Î¨¥Í¥Ä", "address": "ÎåÄÍµ¨ Îã¨ÏÑúÍµ¨ ÏÑúÎãπÎ°ú 30", "schedule": "Ïùº 09:00~13:00", "price": "ÌöåÎπÑ ÎÇ®:Ïõî 2ÎßåÏõê, Ïó¨:Ïõî 1ÎßåÏõê (Í∞ÄÏûÖÎπÑ 3ÎßåÏõê)", "insta": "", "link": "https://open.kakao.com/o/sNOhf3Ah", "lat": 35.8545121028952, "lng": 128.496514228915, "id": 25, "is_urgent": false, "urgent_msg": ""}, {"name": "DGZ", "target": "ÏÑ±Ïù∏", "address": "ÏÑúÏö∏ ÎèôÏûëÍµ¨ Ïû•ÏäπÎ∞∞Í∏∞Î°ú10Í∞ÄÍ∏∏ 35", "schedule": "Ïùº 9:30~14:20 (ÎÇ®ÎÖÄ ÎëêÏãúÍ∞ÑÏî©)", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê (ÌòÑÏû¨ Î¨¥Î£å)", "insta": "dgz_volleyball_club", "link": "", "lat": 37.5027160069897, "lng": 126.940926768444, "angle": 0.0, "id": 26, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïó¨ÏàòÏóêÏù¥Ïä§", "target": "ÏÑ±Ïù∏", "address": "Ï†ÑÎÇ® Ïó¨ÏàòÏãú ÏõÖÏ≤úÎ∂Å4Î°ú 9", "schedule": "Ìôî 18:30~21:40 / Í∏à 18:30~21:40", "price": "Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "yeosu_ace_volleyball", "link": "", "lat": 34.7483267150984, "lng": 127.684825674004, "id": 27, "is_urgent": false, "urgent_msg": ""}, {"name": "V.O.L", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎèôÏûëÍµ¨ Ïû•ÏäπÎ∞∞Í∏∞Î°ú10Í∞ÄÍ∏∏ 35", "schedule": "Ïàò 18:30~21:30 / ÌÜ† 12:30~18:00", "price": "Ïõî 4ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "v.o.l_volleyball", "link": "", "lat": 37.5027160069897, "lng": 126.940726768444, "angle": 3.141592653589793, "id": 28, "is_urgent": false, "urgent_msg": ""}, {"name": "Î†àÏù¥ÎçîÏä§", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÏïàÏÑ±Ïãú ÎπÑÎ£°Î°ú 78", "schedule": "Ìôî 19:00~21:30 / Í∏à 19:00~21:30", "price": "30ÏÑ∏ ÎØ∏Îßå Ïõî 1ÎßåÏõê, 30ÏÑ∏ Ïù¥ÏÉÅ Ïõî 2ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ ÏóÜÏùå", "insta": "raiders_volleyball_team", "link": "", "lat": 37.015078008763, "lng": 127.262820902801, "angle": 3.141592653589793, "id": 29, "is_urgent": false, "urgent_msg": ""}, {"name": "Í≤ΩÏ£º ÎçîÏºÄÏù¥", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÎ∂Å Í≤ΩÏ£ºÏãú Í¥ëÏ§ë2Í∏∏ 28", "schedule": "Ìôî 18:00~20:00 / Î™© 18:00~20:00", "price": "Ïõî 3.5ÎßåÏõê (Ïó∞ÎÇ© 3ÎßåÏõê) / 1ÌöåÏ≤¥ÌóòÎπÑ Î¨¥Î£å", "insta": "thek_vbc", "link": "pf.kakao.com/_xcTaxmn", "lat": 35.8849473288934, "lng": 129.229737107908, "id": 30, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏõêÏ£º Ïä§ÎßàÏùº Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "Î¨¥Í¥Ä", "address": "Í∞ïÏõê ÏõêÏ£ºÏãú ÎÇ®ÏõêÎ°ú 551", "schedule": "Ìôî 18:00~22:00 / ÌÜ† 13:00~16:00", "price": "Ïõî ÏÑ±Ïù∏ 2.5ÎßåÏõê, ÎåÄÌïôÏÉù1.5ÎßåÏõê / Í≤åÏä§Ìä∏ÎπÑ 5Ï≤úÏõê", "insta": "smile.volleyball.club_", "link": "https://open.kakao.com/o/gTs0Mpse", "lat": 37.3338307104893, "lng": 127.946303709594, "id": 31, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïö∞ÏÇ¨Î™® SWVC", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎèÑÎ¥âÍµ¨ Ïö∞Ïù¥Ï≤úÎ°ú 432", "schedule": "Ïùº 13:00~18:00", "price": "Ïõî 4ÎßåÏõê(ÌïôÏÉù Î∞è Î¨¥ÏßÅÏùÄ 3ÎßåÏõê) / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "swvc_volley", "link": "", "lat": 37.6526987118348, "lng": 127.0184004627, "id": 32, "is_urgent": false, "urgent_msg": ""}, {"name": "NWN", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "ÏÑúÏö∏ ÎÖ∏ÏõêÍµ¨ ÌïúÍ∏ÄÎπÑÏÑùÎ°ú 566", "schedule": "Ïàò 18:30~21:30 / ÌÜ† 15:00~19:00", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "nowon_no.1_volleyball", "link": "https://m.cafe.daum.net/nowon-no.1/_rec?utm_source=ig&utm_medium=social&utm_content=link_in_bio", "lat": 37.6648178269709, "lng": 127.054322233957, "id": 33, "is_urgent": false, "urgent_msg": ""}, {"name": "Ïñ¥ÎÇòÎçîÎ†àÎ≤®", "target": "Î¨¥Í¥Ä", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú Îã§Ï†ïÎÇ®Î°ú 91", "schedule": "Ïàò 19:00~21:30", "price": "Ïã†Í∑ú Ï≤´Îã¨ 6Îßå / Ïõî 3Îßå / Í≤åÏä§Ìä∏1ÌöåÎ¨¥Î£å(2Ìöå 1ÎßåÏõê)", "insta": "khp4949", "link": "https://open.kakao.com/o/g3dvQE4g", "lat": 36.4939039101709, "lng": 127.250966962615, "id": 34, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏãúÌù• ÏàòÏöîÎ∞∞Íµ¨Ìöå ÌîΩÏóÖÍ≤åÏûÑ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ ÏãúÌù•Ïãú Ïû•Í≥°Î°ú54Î≤àÍ∏∏ 14", "schedule": "Ïàò 17:50~20:50", "price": "ÏóÜÏùå", "insta": "volleyball_pickup_siheung", "link": "https://open.kakao.com/o/s2KVlj0h", "lat": 37.380779446634, "lng": 126.78327876897, "id": 35, "is_urgent": false, "urgent_msg": ""}, {"name": "Íµ∞Ìè¨Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Í≤ΩÍ∏∞ Íµ∞Ìè¨Ïãú ÏÇ∞Î≥∏Î°ú 267", "schedule": "Ïùº 10:00~16:00", "price": "Ïõî 2.5ÎßåÏõê / Í≤åÏä§Ìä∏ 1ÎßåÏõê", "insta": "gunpo_volleyball", "link": "https://open.kakao.com/o/g1qV2i3h", "lat": 37.3540356844596, "lng": 126.936815220052, "id": 36, "is_urgent": false, "urgent_msg": ""}, {"name": "Î∂ÄÏÇ∞Î∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, Ï≤≠ÏÜåÎÖÑ, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "Î∂ÄÏÇ∞ Î∂ÅÍµ¨ ÎçïÏ≤ú2Í∏∏ 10", "schedule": "Ìôî 18:00~21:00", "price": "ÏÑ±Ïù∏ Ïõî 2ÎßåÏõê (ÎåÄÌïôÏÉù Ïõî 1.5ÎßåÏõê, Í≥†Îì±ÌïôÏÉù Ïõî 1ÎßåÏõê)", "insta": "volleyball_busan", "link": "https://open.kakao.com/o/suiGnD0", "lat": 35.2082050651349, "lng": 129.006965137504, "id": 37, "is_urgent": false, "urgent_msg": ""}, {"name": "HBÏïÑÏπ¥Îç∞ÎØ∏", "target": "Î¨¥Í¥Ä", "address": "ÏÑúÏö∏ ÎèÑÎ¥âÍµ¨ ÎÖ∏Ìï¥Î°ú 273", "schedule": "Ïõî 17:00-18:30 / Ïùº 15:00-16:30 / Ïùº 16:30-18:00", "price": "1Ìöå Î¨¥Î£åÏ≤¥Ìóò / ÌïôÏÉù 12ÎßåÏõê / ÏÑ±Ïù∏ 14ÎßåÏõê / Í∞úÏù∏Î†àÏä® Î¨∏Ïùò", "insta": "h_bacademy", "link": "https://m.blog.naver.com/rudejr2238", "lat": 37.6518477614279, "lng": 127.038744954072, "id": 38, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÎßàÏùåÎ°ú 284", "schedule": "Ìôî 19:00~22:00", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.519724340798, "lng": 127.236589788899, "id": 39, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÏÑ∏Ï¢ÖÎ°ú 941", "schedule": "Î™© 18:30~21:00", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.4877156432012, "lng": 127.243231178402, "id": 40, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏÑ∏Ï¢Ö Îß•Ïä§(Team Max)", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù, ÏÑ†Ï∂úÍ∞ÄÎä•", "address": "ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú ÏïÑÎ¶ÑÎèô 804", "schedule": "Ïùº  9:00~12:00 (ÎÇ®) / 12:00~4:00 (Ïó¨)", "price": "Í∞ÄÏûÖÎπÑ 2ÎßåÏõê / Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ 5Ï≤úÏõê", "insta": "max_volleyball_", "link": "https://open.kakao.com/o/sT6CiRdf", "lat": 36.523100478656, "lng": 127.255014907693, "id": 41, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏàúÏ≤úÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® ÏàúÏ≤úÏãú Î∂ÅÏ†ï2Í∏∏ 20", "schedule": "Ìôî 18:30~22:00", "price": "Ïõî 3.5ÎßåÏõê", "insta": "heooooooeh", "link": "", "lat": 34.9646430183578, "lng": 127.483992847829, "id": 42, "is_urgent": false, "urgent_msg": ""}, {"name": "ÏàúÏ≤úÎ∞∞Íµ¨ÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® ÏàúÏ≤úÏãú ÏàúÍ¥ëÎ°ú 15", "schedule": "Í∏à 18:30~21:30", "price": "Ïõî 3.5ÎßåÏõê", "insta": "heooooooeh", "link": "", "lat": 34.9560628875777, "lng": 127.522478978541, "id": 43, "is_urgent": false, "urgent_msg": ""}, {"name": "Î™©Ìè¨ÌïòÎÇòÌÅ¥ÎüΩ", "target": "ÏÑ±Ïù∏, ÎåÄÌïôÏÉù", "address": "Ï†ÑÎÇ® Î™©Ìè¨Ïãú ÎÇ®ÏïÖ1Î°ú16Î≤àÍ∏∏ 25", "schedule": "Ïõî 18:30~21:40 / Ïàò 18:30~21:40 / Í∏à 18:30~21:40", "price": "Ïõî 3ÎßåÏõê / Í≤åÏä§Ìä∏ ÎπÑÏö© ÏóÜÏùå", "insta": "mokpo_hana_vc", "link": "", "lat": 34.8080460089449, "lng": 126.449995234402, "id": 44, "is_urgent": false, "urgent_msg": ""}, {"name": "ÌïòÏù¥ÏõêÎ∞∞Íµ¨ÎèôÌò∏Ìöå", "target": "ÏÑ±Ïù∏", "address": "Í≤ΩÍ∏∞ ÌïòÎÇ®Ïãú ÏïÑÎ¶¨ÏàòÎ°ú 600", "schedule": "Ìôî 10:00~12:00 / Ïàò 10:00~12:00 / Î™© 10:00~12:00", "price": "Ïõî 1ÎßåÏõê", "insta": "", "link": "https://www.daangn.com/kr/community/%ED%95%98%EB%82%A8%EC%8B%9C-%EC%97%AC%EC%9E%90-%EB%B0%B0%EA%B5%AC-%EB%8F%99%ED%98%B8%ED%9A%8C-54tne9r282sz/", "lat": 37.5657002161617, "lng": 127.193906244378, "id": 45, "is_urgent": false, "urgent_msg": ""}];
        var markers = []; 
        
        var defaultImageSrc = './marker_yellow.png'; 
        var urgentImageSrc = './marker_red.png'; 
        var imageSize = new kakao.maps.Size(40, 53); 
        var imageOption = {offset: new kakao.maps.Point(20, 53)}; 
        
        var defaultMarkerImage = new kakao.maps.MarkerImage(defaultImageSrc, imageSize, imageOption);
        var urgentMarkerImage = new kakao.maps.MarkerImage(urgentImageSrc, imageSize, imageOption);

        var gpsSvg = 'data:image/svg+xml;charset=UTF-8,%3csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3e%3ccircle cx="50" cy="50" r="45" fill="rgba(66, 133, 244, 0.3)"/%3e%3ccircle cx="50" cy="50" r="25" fill="white"/%3e%3ccircle cx="50" cy="50" r="20" fill="%234285F4"/%3e%3c/svg%3e';
        var gpsImage = new kakao.maps.MarkerImage(gpsSvg, new kakao.maps.Size(44,44), {offset: new kakao.maps.Point(22,22)});
        var myMarker = null;
        var instaCssIcon = '<div class="instagram" title="Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Î≥¥Îü¨Í∞ÄÍ∏∞"></div>';

        clubs.forEach(function(club) {
            if (!club.lat || !club.lng) return;
            var latlng = new kakao.maps.LatLng(club.lat, club.lng);
            var marker;
            if (club.is_urgent) {
                marker = new kakao.maps.Marker({ position: latlng, image: urgentMarkerImage, zIndex: 9999 });
                marker.setMap(map); 
            } else {
                marker = new kakao.maps.Marker({ position: latlng, image: defaultMarkerImage });
            }
            
            var labelClass = club.is_urgent ? 'label urgent' : 'label';
            var iconHtml = club.is_urgent ? 'üî• ' : '';
            var content = '<div class="' + labelClass + '" onclick="triggerMarkerClick(' + club.id + ')">' + iconHtml + club.name + '</div>';
            var xAnc = 0.5; var yAnc = 1;   
            if (club.angle !== undefined) { xAnc = 0.5 - (Math.cos(club.angle) * 0.5); }
            var customOverlay = new kakao.maps.CustomOverlay({ position: latlng, content: content, xAnchor: xAnc, yAnchor: yAnc, zIndex: 9999 });
            
            if (club.is_urgent) { customOverlay.setMap(map); }
            kakao.maps.event.addListener(marker, 'click', function() { openClubDetail(club.id); });
            
            markers.push({ marker: marker, overlay: customOverlay, club: club, isVisible: true });
        });

        var initialClusterMarkers = [];
        markers.forEach(function(item) {
            if (!item.club.is_urgent) { initialClusterMarkers.push(item.marker); }
        });
        clusterer.addMarkers(initialClusterMarkers);

        function triggerMarkerClick(id) {
            var target = markers.find(m => m.club.id === id);
            if (target && target.marker) kakao.maps.event.trigger(target.marker, 'click');
        }

        function updateLabelVisibility() {
            var level = map.getLevel(); 
            var showNormalLabels = (level <= 5); 
            var showUrgentLabels = (level <= 8); 
            markers.forEach(function(item) {
                if (!item.isVisible) return; 
                if (item.club.is_urgent) { 
                    if (showUrgentLabels) item.overlay.setMap(map); else item.overlay.setMap(null);
                } else { 
                    if (showNormalLabels) item.overlay.setMap(map); else item.overlay.setMap(null); 
                }
            });
        }
        
        kakao.maps.event.addListener(map, 'zoom_changed', updateLabelVisibility);

        function parseScheduleText(text) {
            var scheduleMap = {};
            if (!text) return scheduleMap;
            // Ïó≠Ïä¨ÎûòÏãú Ìïú Î≤àÎßå ÏÇ¨Ïö© (ÏàòÏ†ïÎê®)
            var segments = text.split(/\s*\/\s*/); 
            segments.forEach(function(segment) {
                // Ïó≠Ïä¨ÎûòÏãú Ìïú Î≤àÎßå ÏÇ¨Ïö© (ÏàòÏ†ïÎê®)
                var timeReg = /(\d{1,2}):(\d{2})\s*[~-]\s*(\d{1,2}):(\d{2})/;
                var match = segment.match(timeReg);
                if (match) {
                    var startH = parseInt(match[1]);
                    var startM = parseInt(match[2]);
                    var endH = parseInt(match[3]);
                    var endM = parseInt(match[4]);
                    
                    function format12(h, m) {
                        var p = h >= 12 ? 'PM' : 'AM';
                        var h12 = h % 12;
                        if (h12 === 0) h12 = 12;
                        var mStr = m < 10 ? '0'+m : m;
                        return p + ' ' + h12 + ':' + mStr;
                    }
                    
                    var displayTime = format12(startH, startM) + '~' + format12(endH, endM);
                    
                    var days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
                    days.forEach(function(day) {
                        if (segment.includes(day)) {
                            scheduleMap[day] = { 
                                startH: startH, startM: startM, 
                                endH: endH, endM: endM, 
                                text: displayTime 
                            };
                        }
                    });
                }
            });
            return scheduleMap;
        }

        function getHourLabel(h) {
            var p = h >= 12 ? 'PM' : 'AM';
            var h12 = h % 12;
            if (h12 === 0) h12 = 12;
            return p + ' ' + h12;
        }

        function renderTimetables(scheduleText) {
            var scheduleData = parseScheduleText(scheduleText);
            var days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
            var dayIndices = {'Ïùº':0, 'Ïõî':1, 'Ìôî':2, 'Ïàò':3, 'Î™©':4, 'Í∏à':5, 'ÌÜ†':6};
            var todayIndex = new Date().getDay(); 
            var todayChar = Object.keys(dayIndices).find(key => dayIndices[key] === todayIndex);

            var minH = 24, maxH = 0;
            var hasData = false;
            
            Object.values(scheduleData).forEach(function(data) {
                if (data.startH < minH) minH = data.startH;
                if (data.endH > maxH) maxH = data.endH;
                hasData = true;
            });

            if (!hasData) { minH = 18; maxH = 22; }
            
            var displayStart = Math.max(6, minH - 2); 
            var displayEnd = Math.min(24, maxH + 2);
            var totalHours = displayEnd - displayStart;

            var availableHeight = window.innerHeight * 0.55; 
            var calculatedRowHeight = availableHeight / totalHours;
            var ROW_HEIGHT = Math.max(32, Math.min(60, calculatedRowHeight));

            var summaryContainer = document.getElementById('summaryContent');
            summaryContainer.innerHTML = '';
            var hasActive = false;
            days.forEach(function(day) {
                var data = scheduleData[day];
                if (data) {
                    hasActive = true;
                    var item = document.createElement('div');
                    item.className = 'st-bubble active';
                    item.innerHTML = '<div class="st-day-text">' + day + 'ÏöîÏùº</div><div class="st-time-text">' + data.text + '</div>';
                    summaryContainer.appendChild(item);
                }
            });
            if (!hasActive) {
                summaryContainer.innerHTML = '<div class="st-bubble"><div class="st-day-text">ÏùºÏ†ï</div><div class="st-time-text">Ï†ïÎ≥¥ÏóÜÏùå</div></div>';
            }

            var fullContainer = document.getElementById('fullContent');
            fullContainer.innerHTML = '';
            
            var ftContainer = document.createElement('div');
            ftContainer.className = 'ft-container';
            
            var headerRow = document.createElement('div');
            headerRow.className = 'ft-header-row-flex';
            var emptyCell = document.createElement('div'); emptyCell.className = 'ft-header-cell time-col';
            headerRow.appendChild(emptyCell);
            
            days.forEach(function(d) {
                var cell = document.createElement('div');
                cell.className = 'ft-header-cell';
                if (d === todayChar) cell.className += ' today';
                cell.innerText = d;
                headerRow.appendChild(cell);
            });
            ftContainer.appendChild(headerRow);

            var bodyRow = document.createElement('div');
            bodyRow.className = 'ft-body';
            bodyRow.style.height = (totalHours * ROW_HEIGHT) + 'px';

            var timeCol = document.createElement('div');
            timeCol.className = 'ft-col-time';
            for(var h = displayStart; h < displayEnd; h++) {
                var label = document.createElement('div');
                label.className = 'ft-time-label';
                label.style.height = ROW_HEIGHT + 'px'; 
                label.innerHTML = getHourLabel(h);
                timeCol.appendChild(label);
            }
            bodyRow.appendChild(timeCol);

            days.forEach(function(d) {
                var dayCol = document.createElement('div');
                dayCol.className = 'ft-col-day';
                
                for(var h = displayStart; h < displayEnd; h++) {
                    var gridLine = document.createElement('div');
                    gridLine.style.height = ROW_HEIGHT + 'px'; 
                    gridLine.style.borderBottom = '1px solid #f8f8f8';
                    gridLine.style.boxSizing = 'border-box';
                    dayCol.appendChild(gridLine);
                }

                var data = scheduleData[d];
                if (data) {
                    var startTotalHours = data.startH + (data.startM / 60) - displayStart;
                    var durationHours = (data.endH + (data.endM / 60)) - (data.startH + (data.startM / 60));
                    
                    var topPx = startTotalHours * ROW_HEIGHT;
                    var heightPx = durationHours * ROW_HEIGHT;

                    var duration = (data.endH + (data.endM / 60)) - (data.startH + (data.startM / 60));
                    var durationStr = Number.isInteger(duration) ? duration : duration.toFixed(1);

                    if (topPx >= 0) {
                        var block = document.createElement('div');
                        block.className = 'ft-event-block';
                        block.style.top = topPx + 'px';
                        block.style.height = (heightPx - 2) + 'px'; 
                        block.innerHTML = data.text.replace('~', '<br>~<br>') + 
                                          '<div style="font-size:9px; opacity:0.8; margin-top:2px;">(' + durationStr + 'h)</div>';
                        dayCol.appendChild(block);
                    }
                }
                bodyRow.appendChild(dayCol);
            });
            
            ftContainer.appendChild(bodyRow);
            fullContainer.appendChild(ftContainer);
        }

        var sheetState = 'PEEK'; 
        var PEEK_HEIGHT = 380; 
        var EXPANDED_HEIGHT = window.innerHeight * 0.9;
        var BUBBLE_HEIGHT = 60;

        function updateSheetState(newState, animation = true) {
            var sheet = document.getElementById('bottomSheet');
            var hint = document.getElementById('expandHint');
            
            sheetState = newState;
            
            if (animation) sheet.style.transition = 'height 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';
            else sheet.style.transition = 'none';

            if (newState === 'CLOSED') {
                sheet.style.height = '0';
            } 
            else if (newState === 'PEEK') {
                sheet.style.height = PEEK_HEIGHT + 'px';
                hint.innerText = '‚ñ¥ ÏúÑÎ°ú Ïò¨Î†§ÏÑú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î≥¥Í∏∞';
                interpolateMorph(0); 
            } 
            else if (newState === 'EXPANDED') {
                sheet.style.height = EXPANDED_HEIGHT + 'px';
                hint.innerText = '‚ñæ ÏïÑÎûòÎ°ú ÎÇ¥Î†§ÏÑú ÏöîÏïΩ Î≥¥Í∏∞';
                interpolateMorph(1); 
            }
        }

        function interpolateMorph(ratio) {
            var summary = document.getElementById('summaryContent');
            var full = document.getElementById('fullContent');
            var container = document.getElementById('timeMorphContainer');
            
            ratio = Math.min(Math.max(ratio, 0), 1);

            if (ratio > 0.8) {
                container.style.height = 'auto'; 
                full.style.position = 'relative'; 
            } else {
                 var targetH = BUBBLE_HEIGHT + (350 * ratio); 
                 container.style.height = targetH + 'px';
                 full.style.position = 'absolute'; 
            }

            if (ratio < 0.5) {
                summary.style.display = 'flex';
                full.style.display = 'none';
                summary.style.opacity = 1 - (ratio * 2);
            } else {
                summary.style.display = 'none';
                full.style.display = 'block';
                full.style.opacity = (ratio - 0.5) * 2;
            }
        }

        function toggleTimeExpand() {
            if (sheetState === 'PEEK') updateSheetState('EXPANDED');
            else if (sheetState === 'EXPANDED') updateSheetState('PEEK');
        }

        function openClubDetail(id) {
            document.getElementById('topSearchInput').blur();
            var club = clubs.find(c => c.id === id);
            
            var titleHtml = club.name;
            if (club.insta) titleHtml += ' <a href="https://instagram.com/' + club.insta + '" target="_blank" class="insta-link">' + instaCssIcon + '</a>';
            document.getElementById('sheetTitle').innerHTML = titleHtml;
            document.getElementById('sheetPrice').innerText = club.price || "ÌöåÎπÑ Ï†ïÎ≥¥ ÏóÜÏùå";
            document.getElementById('sheetAddressVal').value = club.address;
            
            renderTimetables(club.schedule);

            var tagHtml = '<span class="tag target">' + club.target + '</span>';
            if(club.link) tagHtml += '<a href="' + club.link + '" target="_blank" style="text-decoration:none"><span class="tag" style="background:#eee">üè† ÌôàÌéòÏù¥ÏßÄ</span></a>';
            document.getElementById('sheetTags').innerHTML = tagHtml;
            document.getElementById('btnWay').href = "https://map.kakao.com/link/to/" + club.name + "," + club.lat + "," + club.lng;
            
            var urgentArea = document.getElementById('urgentArea');
            if (club.is_urgent && club.urgent_msg) {
                urgentArea.innerHTML = '<div class="urgent-banner">üî• ' + club.urgent_msg + '</div>';
                urgentArea.style.display = 'block';
            } else { urgentArea.style.display = 'none'; }

            // [NEW] Ï∞úÌïòÍ∏∞ Î≤ÑÌäºÏóê onclick Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
            var btnBookmark = document.getElementById('btnBookmark');
            btnBookmark.onclick = function() { bookmarkTeam(club.id); };
            
            updateSheetState('PEEK');
            
            var targetLevel = 4;
            map.setLevel(targetLevel, {animate: true});
            var moveLatLon = new kakao.maps.LatLng(club.lat, club.lng);
            var projection = map.getProjection();
            var centerPoint = projection.pointFromCoords(moveLatLon);
            var offsetY = Math.min(window.innerHeight * 0.13, 150); 
            var newCenterPoint = new kakao.maps.Point(centerPoint.x, centerPoint.y + offsetY);
            var newCenterLatLon = projection.coordsFromPoint(newCenterPoint);
            map.panTo(newCenterLatLon);
        }

        function closeBottomSheet() { updateSheetState('CLOSED'); }
        document.getElementById('btnCopy').onclick = function() { copyAddress(document.getElementById('sheetAddressVal').value); };
        function copyAddress(addr) {
            if (navigator.clipboard && navigator.clipboard.writeText) { navigator.clipboard.writeText(addr).then(() => { alert('Ï£ºÏÜåÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã'); }); } 
            else { var t = document.createElement("input"); t.value = addr; document.body.appendChild(t); t.select(); document.execCommand("copy"); document.body.removeChild(t); alert('Ï£ºÏÜåÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã'); }
        }

        // Í∏¥Í∏â Íµ¨Ïù∏ Ìã∞Ïª§ Î°úÏßÅ
        var urgentClubs = clubs.filter(c => c.is_urgent && c.urgent_msg);
        var uniqueTickerList = [];
        var processedTeams = {};
        
        urgentClubs.forEach(function(c) {
            if (!processedTeams[c.name]) {
                uniqueTickerList.push(c);
                processedTeams[c.name] = true;
            }
        });

        if (uniqueTickerList.length > 0) {
            var tickerContainer = document.getElementById('urgentTicker');
            var tickerList = document.getElementById('tickerList');
            tickerContainer.style.display = 'flex';
            
            uniqueTickerList.forEach(function(c) {
                var li = document.createElement('li');
                li.className = 'ticker-item';
                li.innerHTML = '<b>[' + c.name + ']</b> ' + c.urgent_msg;
                li.onclick = function() { openClubDetail(c.id); };
                tickerList.appendChild(li);
            });

            if (uniqueTickerList.length > 1) {
                var tickerHeight = 40;
                var currentIndex = 0;
                setInterval(function() {
                    currentIndex++;
                    tickerList.style.top = '-' + (currentIndex * tickerHeight) + 'px';
                    
                    if (currentIndex === uniqueTickerList.length) {
                        setTimeout(function() {
                            tickerList.style.transition = 'none';
                            tickerList.style.top = '0px';
                            currentIndex = 0;
                            setTimeout(function() { tickerList.style.transition = 'top 0.5s ease-in-out'; }, 50);
                        }, 500); 
                    } else {
                        if (currentIndex === uniqueTickerList.length) currentIndex = 0;
                    }
                }, 3000);
                
                var firstClone = tickerList.children[0].cloneNode(true);
                firstClone.onclick = function() { openClubDetail(uniqueTickerList[0].id); };
                tickerList.appendChild(firstClone);
            }
        }

        const sheet = document.getElementById('bottomSheet');
        const handleArea = document.getElementById('sheetHandle');
        let startY = 0; let currentY = 0; let isDragging = false;
        let startHeight = 0;

        function bHandleStart(e) { 
            startY = e.touches ? e.touches[0].clientY : e.clientY; 
            isDragging = true; 
            sheet.style.transition = 'none'; 
            document.getElementById('timeMorphContainer').style.transition = 'none';
            startHeight = sheet.offsetHeight;
        }
        
        function bHandleMove(e) { 
            if (!isDragging) return; 
            if(e.cancelable && e.type.startsWith('touch')) e.preventDefault(); 
            currentY = e.touches ? e.touches[0].clientY : e.clientY; 
            const deltaY = currentY - startY; 
            
            let newHeight = startHeight - deltaY;
            if (newHeight > EXPANDED_HEIGHT) newHeight = EXPANDED_HEIGHT;
            sheet.style.height = newHeight + 'px';
            let ratio = (newHeight - PEEK_HEIGHT) / (EXPANDED_HEIGHT - PEEK_HEIGHT);
            interpolateMorph(ratio);
        }
        
        function bHandleEnd(e) { 
            if (!isDragging) return; isDragging = false; 
            sheet.style.transition = 'height 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';
            document.getElementById('timeMorphContainer').style.transition = 'height 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';
            let currentH = sheet.offsetHeight;
            if (currentH > (PEEK_HEIGHT + EXPANDED_HEIGHT) / 2) { updateSheetState('EXPANDED'); } 
            else { if (currentH < PEEK_HEIGHT * 0.8) updateSheetState('CLOSED'); else updateSheetState('PEEK'); }
            currentY = 0; startY = 0; 
        }
        
        handleArea.addEventListener('touchstart', bHandleStart, {passive: true}); handleArea.addEventListener('touchmove', bHandleMove, {passive: false}); handleArea.addEventListener('touchend', bHandleEnd); handleArea.addEventListener('mousedown', bHandleStart); window.addEventListener('mousemove', bHandleMove); window.addEventListener('mouseup', bHandleEnd);

        const filterSheet = document.getElementById('filterSheet');
        const filterHandle = document.getElementById('filterHandle');
        let fStartY = 0; let fCurrentY = 0; let fIsDragging = false;
        function fHandleStart(e) { fStartY = e.touches ? e.touches[0].clientY : e.clientY; fIsDragging = true; filterSheet.style.transition = 'none'; }
        
        function fHandleMove(e) { 
            if (!fIsDragging) return; 
            if(e.cancelable && e.type.startsWith('touch')) e.preventDefault(); 
            fCurrentY = e.touches ? e.touches[0].clientY : e.clientY; 
            const deltaY = fCurrentY - fStartY; 
            // Î∞±Ìã±(`) Î¨∏Î≤ï ÏàòÏ†ï ÏôÑÎ£å
            if (deltaY < 0) { filterSheet.style.transform = `translateY(${deltaY}px)`; } 
        }
        
        function fHandleEnd(e) { if (!fIsDragging) return; fIsDragging = false; let endY = e.changedTouches ? e.changedTouches[0].clientY : fCurrentY; if (!e.touches && fCurrentY === 0) endY = fStartY; const deltaY = endY - fStartY; filterSheet.style.transition = 'transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)'; if (deltaY < -50) { closeFilterSheet(); } else { filterSheet.style.transform = "translateY(0)"; } fCurrentY = 0; fStartY = 0; }
        filterHandle.addEventListener('touchstart', fHandleStart, {passive: true}); filterHandle.addEventListener('touchmove', fHandleMove, {passive: false}); filterHandle.addEventListener('touchend', fHandleEnd); filterHandle.addEventListener('mousedown', fHandleStart); window.addEventListener('mousemove', fHandleMove); window.addEventListener('mouseup', fHandleEnd);

        function toggleFilterSheet() {
            var sheet = document.getElementById('filterSheet');
            if (sheet.style.transform === "translateY(0px)" || sheet.style.transform === "") { closeFilterSheet(); } else { openFilterSheet(); }
        }

        function moveToMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude, lon = position.coords.longitude;
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    if (myMarker) myMarker.setMap(null);
                    myMarker = new kakao.maps.Marker({ map: map, position: locPosition, image: gpsImage });
                    map.panTo(locPosition);
                });
            } else { alert('ÏúÑÏπò Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.'); }
        }

        var selectedFilters = { 'region': [], 'day': [], 'target': [] };
        function openFilterSheet() { document.getElementById('filterSheet').style.transform = "translateY(0)"; }
        function closeFilterSheet() { document.getElementById('filterSheet').style.transform = "translateY(-100%)"; }
        function toggleFilter(category, value, element) {
            var index = selectedFilters[category].indexOf(value);
            if (index === -1) { selectedFilters[category].push(value); element.classList.add('selected'); } 
            else { selectedFilters[category].splice(index, 1); element.classList.remove('selected'); }
        }
        function resetFilters() {
            selectedFilters = { 'region': [], 'day': [], 'target': [] };
            document.querySelectorAll('.chip').forEach(el => el.classList.remove('selected'));
            document.getElementById('topSearchInput').value = ""; 
            applyFilters();
        }

        function applyFilters() {
            if (window.event && window.event.type === 'click') closeFilterSheet();
            var keyword = document.getElementById('topSearchInput').value.trim();
            var filterCount = selectedFilters.region.length + selectedFilters.day.length + selectedFilters.target.length;
            if (filterCount > 0) { document.getElementById('filterBadge').classList.add('active'); } 
            else { document.getElementById('filterBadge').classList.remove('active'); }

            clusterer.clear(); 
            var visibleNormalMarkers = []; 
            var bounds = new kakao.maps.LatLngBounds();

            markers.forEach(function(item) {
                var club = item.club;
                var regionMatch = true;
                if (selectedFilters.region.length > 0) {
                    regionMatch = false;
                    for (var i = 0; i < selectedFilters.region.length; i++) {
                        var r = selectedFilters.region[i];
                        if (r === "Ï∂©Ï≤≠" && (club.address.startsWith("Ï∂©ÎÇ®") || club.address.startsWith("Ï∂©Î∂Å") || club.address.startsWith("ÎåÄÏ†Ñ") || club.address.startsWith("ÏÑ∏Ï¢Ö"))) regionMatch = true;
                        else if (r === "Ï†ÑÎùº" && (club.address.startsWith("Ï†ÑÎÇ®") || club.address.startsWith("Ï†ÑÎ∂Å") || club.address.startsWith("Í¥ëÏ£º"))) regionMatch = true;
                        else if (r === "Í≤ΩÏÉÅ" && (club.address.startsWith("Í≤ΩÎÇ®") || club.address.startsWith("Í≤ΩÎ∂Å") || club.address.startsWith("ÎåÄÍµ¨") || club.address.startsWith("Î∂ÄÏÇ∞") || club.address.startsWith("Ïö∏ÏÇ∞"))) regionMatch = true;
                        else if (club.address.startsWith(r)) regionMatch = true;
                    }
                }
                var dayMatch = true;
                if (selectedFilters.day.length > 0) {
                    dayMatch = false;
                    var cleanSchedule = club.schedule.replace(/ÏöîÏùº/g, "");
                    if (cleanSchedule.includes("Îß§Ïùº")) dayMatch = true;
                    else { for (var i = 0; i < selectedFilters.day.length; i++) { if (cleanSchedule.includes(selectedFilters.day[i])) dayMatch = true; } }
                }
                var targetMatch = true;
                if (selectedFilters.target.length > 0) {
                    targetMatch = false;
                    var hasSpecialFilter = selectedFilters.target.some(t => ["Ïó¨ÏÑ±Ï†ÑÏö©", "ÎÇ®ÏÑ±Ï†ÑÏö©", "ÏÑ†Ï∂úÍ∞ÄÎä•", "6Ïù∏Ï†ú"].includes(t));
                    for (var i = 0; i < selectedFilters.target.length; i++) { if (club.target.includes(selectedFilters.target[i])) targetMatch = true; }
                    if (!hasSpecialFilter && club.target.includes("Î¨¥Í¥Ä")) targetMatch = true;
                }
                var keywordMatch = true;
                if (keyword.length > 0) { if (!club.name.includes(keyword) && !club.address.includes(keyword)) { keywordMatch = false; } }

                if (regionMatch && dayMatch && targetMatch && keywordMatch) { 
                    item.isVisible = true; 
                    if (club.is_urgent) { item.marker.setMap(map); } 
                    else { visibleNormalMarkers.push(item.marker); }
                    bounds.extend(item.marker.getPosition());
                } else { 
                    item.isVisible = false; 
                    item.marker.setMap(null); 
                    item.overlay.setMap(null); 
                }
            });
            
            clusterer.addMarkers(visibleNormalMarkers);
            updateLabelVisibility();

            if (!bounds.isEmpty() && (keyword.length > 0 || filterCount > 0)) { map.setBounds(bounds); }
        }

        applyFilters();
    </script>
</body>
</html>